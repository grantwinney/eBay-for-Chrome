/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
function Transaction(aItemId, aTransactionId) {
    this._init(aItemId, aTransactionId);
}
Transaction.SCHEMA = {
    NAME: "Transaction",
    PROPERTIES: {
        "itemId": { type: "string", xml: "Item.ItemID" },
        "transactionId": { type: "string", xml: "TransactionID" },
        "creationTime": { type: "string", xml: "CreatedDate" },
        "quantityPurchased": { type: "number", xml: "QuantityPurchased" },
        "buyerUserId": { type: "string", xml: "Buyer.UserID" },
        "isPaidFor": { type: "boolean", xml: "" },
        "isShipped": { type: "boolean", xml: "" },
        "isRefunded": { type: "boolean", xml: "" },
        "feedbackLeftType": { type: "string", xml: "FeedbackLeft.CommentType" },
        "feedbackReceivedType": { type: "string", xml: "FeedbackReceived.CommentType" },
        "transactionPrice": { type: "number", xml: "TransactionPrice|TotalTransactionPrice|Item.SellingStatus.CurrentPrice" },
        "transactionPriceCurrency": { type: "string", xml: "TransactionPrice.@currencyID|TotalTransactionPrice.@currencyID|Item.SellingStatus.CurrentPrice.@currencyID" },
        "convertedTransactionPrice": { type: "number", xml: "ConvertedTransactionPrice" },
        "convertedTransactionPriceCurrency": { type: "string", xml: "ConvertedTransactionPrice.@currencyID" }
    }
};
Transaction.TYPES = {
    BUYING: "Buying",
    SELLING: "Selling"
};
Transaction.prototype = {
    name: Transaction.SCHEMA.NAME,
    _init: function (aItemId, aTransactionId) {
        this.set("itemId", aItemId);
        this.set("transactionId", aTransactionId);
    },
    get: function (aProperty) {
        return this["_" + aProperty];
    },
    set: function (aProperty, aValue) {
        var type = Transaction.SCHEMA.PROPERTIES[aProperty].type;
        aValue = ObjectHelper.getTypedValue(type, aValue);
        this["_" + aProperty] = aValue;
    },
    updateTo: function (aNewObject) {
        return ObjectHelper.updateTo(this, aNewObject, Transaction.SCHEMA);
    },
    updateWithJSON: function (aJSON) {
        ObjectHelper.updateWithJSON(this, aJSON, Transaction.SCHEMA);
    },
    copy: function () {
        return ObjectHelper.copyObject(this, Transaction);
    },
    fromXML: function (aXmlNode, aExclusivePrefix, aTransactionType) {
        var account;
        var buyerUserId;
        var paidStatus;
        var transaction = ObjectHelper.fromXML(aXmlNode, Transaction, aExclusivePrefix);
        this.updateTo(transaction);
        if (this.get("creationTime")) {
            this.set("creationTime", UtilityHelper.dateFromIso8601(this.get("creationTime")).getTime());
        }
        switch (aTransactionType) {
            case Transaction.TYPES.BUYING:
                account = Account.getAccount();
                buyerUserId = account.get("userId") || "";
                this.set("buyerUserId", buyerUserId);
                switch ($(aXmlNode).find("BuyerPaidStatus").text()) {
                    case "MarkedAsPaid":
                    case "PaidWithEscrow":
                    case "PaidWithPaisapay":
                    case "PaidWithPaisaPayEscrow":
                    case "PaidWithPayPal":
                        paidStatus = true;
                        break;
                    default:
                        paidStatus = false;
                }
                this.set("isPaidFor", paidStatus);
                break;
            case Transaction.TYPES.SELLING:
                buyerUserId = $(aXmlNode).find("Buyer").find("UserID").text();
                this.set("buyerUserId", buyerUserId);
                var refunded = false;
                switch ($(aXmlNode).find("SellerPaidStatus").text()) {
                    case "MarkedAsPaid":
                    case "PaidWithEscrow":
                    case "PaidWithPaisapay":
                    case "PaidWithPaisaPayEscrow":
                    case "PaidWithPayPal":
                        paidStatus = true;
                        break;
                    case "Refunded":
                        paidStatus = true;
                        refunded = true;
                        break;
                    default:
                        paidStatus = false;
                }
                this.set("isPaidFor", paidStatus);
                this.set("isRefunded", refunded);
                break;
        }
        var isShipped = $(aXmlNode).find("ShippedTime").text().length > 0;
        this.set("isShipped", isShipped);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNhY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9iYWNrZ3JvdW5kL2NvcmUvb2JqZWN0cy90cmFuc2FjdGlvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQVVILHFCQUFxQixPQUFPLEVBQUUsY0FBYztJQUMxQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQztBQUN0QyxDQUFDO0FBR0QsV0FBVyxDQUFDLE1BQU0sR0FBRztJQUNuQixJQUFJLEVBQUUsYUFBYTtJQUNuQixVQUFVLEVBQUU7UUFDVixRQUFRLEVBQW1CLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRyxHQUFHLEVBQUUsYUFBYSxFQUFFO1FBQ2xFLGVBQWUsRUFBWSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUcsR0FBRyxFQUFFLGVBQWUsRUFBRTtRQUNwRSxjQUFjLEVBQWEsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFHLEdBQUcsRUFBRSxhQUFhLEVBQUU7UUFDbEUsbUJBQW1CLEVBQVEsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFHLEdBQUcsRUFBRSxtQkFBbUIsRUFBRTtRQUN4RSxhQUFhLEVBQWMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFHLEdBQUcsRUFBRSxjQUFjLEVBQUU7UUFDbkUsV0FBVyxFQUFnQixFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRTtRQUN2RCxXQUFXLEVBQWdCLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFO1FBQ3ZELFlBQVksRUFBZSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRTtRQUN2RCxrQkFBa0IsRUFDaEIsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBQywwQkFBMEIsRUFBRTtRQUNwRCxzQkFBc0IsRUFDcEIsRUFBRSxJQUFJLEVBQUUsUUFB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Q25CLFVBQVUsR0FBRyxJQUFJLENBQUM7d0JBQ2xCLEtBQUssQ0FBQztvQkFDUixLQUFLLFVBQVU7d0JBQ2IsVUFBVSxHQUFHLElBQUksQ0FBQzt3QkFDbEIsUUFBUSxHQUFHLElBQUksQ0FBQzt3QkFDaEIsS0FBSyxDQUFDO29CQUNSO3dCQUNFLFVBQVUsR0FBRyxLQUFLLENBQUM7Z0JBQ3ZCLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUM7Z0JBQ2xDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUNqQyxLQUFLLENBQUM7UUFDVixDQUFDO1FBRUQsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2xFLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgKEMpIDIwMDctMjAxNSBlQmF5IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqL1xuXG4vKlxuICB2YXIgT2JqZWN0SGVscGVyID0gcmVxdWlyZShcImNvcmUvaGVscGVycy9vYmplY3RIZWxwZXJcIikuT2JqZWN0SGVscGVyO1xuICB2YXIgVXRpbGl0eUhlbHBlciA9IHJlcXVpcmUoXCJoZWxwZXJzL3V0aWxpdHlIZWxwZXJcIikuVXRpbGl0eUhlbHBlcjtcbiovXG5cbi8qKlxuICogVHJhbnNhY3Rpb24gRGF0YSBUcmFuc2ZlciBPYmplY3QuXG4gKi9cbmZ1bmN0aW9uIFRyYW5zYWN0aW9uKGFJdGVtSWQsIGFUcmFuc2FjdGlvbklkKSB7XG4gIHRoaXMuX2luaXQoYUl0ZW1JZCwgYVRyYW5zYWN0aW9uSWQpO1xufVxuXG4vKiBEVE8gU2NoZW1hLiAqL1xuVHJhbnNhY3Rpb24uU0NIRU1BID0ge1xuICBOQU1FOiBcIlRyYW5zYWN0aW9uXCIsXG4gIFBST1BFUlRJRVM6IHtcbiAgICBcIml0ZW1JZFwiOiAgICAgICAgICAgICAgICAgIHsgdHlwZTogXCJzdHJpbmdcIiwgIHhtbDogXCJJdGVtLkl0ZW1JRFwiIH0sXG4gICAgXCJ0cmFuc2FjdGlvbklkXCI6ICAgICAgICAgICB7IHR5cGU6IFwic3RyaW5nXCIsICB4bWw6IFwiVHJhbnNhY3Rpb25JRFwiIH0sXG4gICAgXCJjcmVhdGlvblRpbWVcIjogICAgICAgICAgICB7IHR5cGU6IFwic3RyaW5nXCIsICB4bWw6IFwiQ3JlYXRlZERhdGVcIiB9LFxuICAgIFwicXVhbnRpdHlQdXJjaGFzZWRcIjogICAgICAgeyB0eXBlOiBcIm51bWJlclwiLCAgeG1sOiBcIlF1YW50aXR5UHVyY2hhc2VkXCIgfSxcbiAgICBcImJ1eWVyVXNlcklkXCI6ICAgICAgICAgICAgIHsgdHlwZTogXCJzdHJpbmdcIiwgIHhtbDogXCJCdXllci5Vc2VySURcIiB9LFxuICAgIFwiaXNQYWlkRm9yXCI6ICAgICAgICAgICAgICAgeyB0eXBlOiBcImJvb2xlYW5cIiwgeG1sOiBcIlwiIH0sXG4gICAgXCJpc1NoaXBwZWRcIjogICAgICAgICAgICAgICB7IHR5cGU6IFwiYm9vbGVhblwiLCB4bWw6IFwiXCIgfSxcbiAgICBcImlzUmVmdW5kZWRcIjogICAgICAgICAgICAgIHsgdHlwZTogXCJib29sZWFuXCIsIHhtbDogXCJcIiB9LFxuICAgIFwiZmVlZGJhY2tMZWZ0VHlwZVwiOlxuICAgICAgeyB0eXBlOiBcInN0cmluZ1wiLCB4bWw6XCJGZWVkYmFja0xlZnQuQ29tbWVudFR5cGVcIiB9LFxuICAgIFwiZmVlZGJhY2tSZWNlaXZlZFR5cGVcIjpcbiAgICAgIHsgdHlwZTogXCJzdHJpbmdcIiwgeG1sOlwiRmVlZGJhY2tSZWNlaXZlZC5Db21tZW50VHlwZVwiIH0sXG4gICAgXCJ0cmFuc2FjdGlvblByaWNlXCI6XG4gICAgICB7IHR5cGU6IFwibnVtYmVyXCIsICB4bWw6IFwiVHJhbnNhY3Rpb25QcmljZXxUb3RhbFRyYW5zYWN0aW9uUHJpY2V8SXRlbS5TZWxsaW5nU3RhdHVzLkN1cnJlbnRQcmljZVwiIH0sXG4gICAgXCJ0cmFuc2FjdGlvblByaWNlQ3VycmVuY3lcIjpcbiAgICAgIHsgdHlwZTogXCJzdHJpbmdcIiwgeG1sOiBcIlRyYW5zYWN0aW9uUHJpY2UuQGN1cnJlbmN5SUR8VG90YWxUcmFuc2FjdGlvblByaWNlLkBjdXJyZW5jeUlEfEl0ZW0uU2VsbGluZ1N0YXR1cy5DdXJyZW50UHJpY2UuQGN1cnJlbmN5SURcIiB9LFxuICAgIFwiY29udmVydGVkVHJhbnNhY3Rpb25QcmljZVwiOlxuICAgICAgeyB0eXBlOiBcIm51bWJlclwiLCAgeG1sOiBcIkNvbnZlcnRlZFRyYW5zYWN0aW9uUHJpY2VcIiB9LFxuICAgIFwiY29udmVydGVkVHJhbnNhY3Rpb25QcmljZUN1cnJlbmN5XCI6XG4gICAgICB7IHR5cGU6IFwic3RyaW5nXCIsICB4bWw6IFwiQ29udmVydGVkVHJhbnNhY3Rpb25QcmljZS5AY3VycmVuY3lJRFwiIH1cbiAgfVxufTtcblxuLyogVHJhbnNhY3Rpb24gdHlwZXMgKi9cblRyYW5zYWN0aW9uLlRZUEVTID0ge1xuICBCVVlJTkc6IFwiQnV5aW5nXCIsXG4gIFNFTExJTkcgOiBcIlNlbGxpbmdcIlxufTtcblxuLyogRFRPIFByb3RvdHlwZS4gKi9cblRyYW5zYWN0aW9uLnByb3RvdHlwZSA9IHtcbiAgLyoqXG4gICAqIFVzZWQgdG8gZGV0ZXJtaW5lIHRoZSB0eXBlIG9mIHRoZSBvYmplY3RcbiAgICovXG4gIG5hbWUgOiBUcmFuc2FjdGlvbi5TQ0hFTUEuTkFNRSxcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIG9iamVjdC5cbiAgICogQHBhcmFtIGFJdGVtSWQgdGhlIGl0ZW0gaWQuXG4gICAqIEBwYXJhbSBhVHJhbnNhY3Rpb25JZCBpcyB0cmFuc2FjdGlvbiBpZC5cbiAgICovXG4gIF9pbml0IDogZnVuY3Rpb24oYUl0ZW1JZCwgYVRyYW5zYWN0aW9uSWQpIHtcbiAgICB0aGlzLnNldChcIml0ZW1JZFwiLCBhSXRlbUlkKTtcbiAgICB0aGlzLnNldChcInRyYW5zYWN0aW9uSWRcIiwgYVRyYW5zYWN0aW9uSWQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gcHJvcGVydHkuXG4gICAqIEBwYXJhbSBhUHJvcGVydHkgdGhlIHByb3BlcnR5IG5hbWUuXG4gICAqIEByZXR1cm4gdGhlIHByb3BlcnR5IHZhbHVlLlxuICAgKi9cbiAgZ2V0IDogZnVuY3Rpb24oYVByb3BlcnR5KSB7XG4gICAgcmV0dXJuIHRoaXNbXCJfXCIgKyBhUHJvcGVydHldO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBnaXZlbiBwcm9wZXJ0eSB0byB0aGUgZ2l2ZW4gdmFsdWUsIGNoZWNraW5nIHRoYXQgdGhlIHZhbHVlIGlzIG9mXG4gICAqIHRoZSBjb3JyZWN0IHR5cGUgZm9yIHRoZSBwcm9wZXJ0eVxuICAgKiBAcGFyYW0gYVByb3BlcnR5IHRoZSBwcm9wZXJ0eSBuYW1lLlxuICAgKiBAcGFyYW0gYVZhbHVlIHRoZSBwcm9wZXJ0eSB2YWx1ZS5cbiAgICovXG4gIHNldCA6IGZ1bmN0aW9uKGFQcm9wZXJ0eSwgYVZhbHVlKSB7XG4gICAgdmFyIHR5cGUgPSBUcmFuc2FjdGlvbi5TQ0hFTUEuUFJPUEVSVElFU1thUHJvcGVydHldLnR5cGU7XG5cbiAgICBhVmFsdWUgPSBPYmplY3RIZWxwZXIuZ2V0VHlwZWRWYWx1ZSh0eXBlLCBhVmFsdWUpO1xuICAgIHRoaXNbXCJfXCIgKyBhUHJvcGVydHldID0gYVZhbHVlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uIHRvIHRoZSBuZXcgdHJhbnNhY3Rpb24gcGFzc2VkLlxuICAgKiBAcmV0dXJuIHRoZSBtb2RpZmllZCBmaWVsZHMsIGlmIGFueS5cbiAgICovXG4gIHVwZGF0ZVRvIDogZnVuY3Rpb24oYU5ld09iamVjdCkge1xuICAgIHJldHVybiBPYmplY3RIZWxwZXIudXBkYXRlVG8odGhpcywgYU5ld09iamVjdCwgVHJhbnNhY3Rpb24uU0NIRU1BKTtcbiAgfSxcblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgY3VycmVudCBpdGVtIHdpdGggYSBKU09OIHBhc3NlZC5cbiAgICovXG4gIHVwZGF0ZVdpdGhKU09OIDogZnVuY3Rpb24oYUpTT04pIHtcbiAgICBPYmplY3RIZWxwZXIudXBkYXRlV2l0aEpTT04odGhpcywgYUpTT04sIFRyYW5zYWN0aW9uLlNDSEVNQSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uXG4gICAqIEByZXR1cm4gdGhlIGNvcHkgb2YgdGhlIHRyYW5zYWN0aW9uXG4gICAqL1xuICBjb3B5IDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIE9iamVjdEhlbHBlci5jb3B5T2JqZWN0KHRoaXMsIFRyYW5zYWN0aW9uKTtcbiAgfSxcblxuICAvKipcbiAgICogUG9wdWxhdGVzIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uIGZyb20gdGhlIHBhc3NlZCBYTUxcbiAgICogQHBhcmFtIGFYbWxOb2RlIHRoZSB4bWwgbm9kZSBmb3IgdGhlIGl0ZW0uXG4gICAqIEBwYXJhbSBhRXhjbHVzaXZlUHJlZml4IHRoZSB4bWwgcHJlZml4LlxuICAgKiBAcGFyYW0gYVRyYW5zYWN0aW9uVHlwZSB0aGUgdHlwZSBvZiB0aGUgdHJhbnNhY3Rpb24uXG4gICAqL1xuICBmcm9tWE1MIDogZnVuY3Rpb24oYVhtbE5vZGUsIGFFeGNsdXNpdmVQcmVmaXgsIGFUcmFuc2FjdGlvblR5cGUpIHtcbiAgICB2YXIgYWNjb3VudDtcbiAgICB2YXIgYnV5ZXJVc2VySWQ7XG4gICAgdmFyIHBhaWRTdGF0dXM7XG4gICAgdmFyIHRyYW5zYWN0aW9uID0gT2JqZWN0SGVscGVyLmZyb21YTUwoXG4gICAgICBhWG1sTm9kZSwgVHJhbnNhY3Rpb24sIGFFeGNsdXNpdmVQcmVmaXgpO1xuICAgIHRoaXMudXBkYXRlVG8odHJhbnNhY3Rpb24pO1xuXG4gICAgaWYgKHRoaXMuZ2V0KFwiY3JlYXRpb25UaW1lXCIpKSB7XG4gICAgICB0aGlzLnNldChcImNyZWF0aW9uVGltZVwiLFxuICAgICAgICBVdGlsaXR5SGVscGVyLmRhdGVGcm9tSXNvODYwMSh0aGlzLmdldChcImNyZWF0aW9uVGltZVwiKSkuZ2V0VGltZSgpKTtcbiAgICB9XG5cbiAgICBzd2l0Y2goYVRyYW5zYWN0aW9uVHlwZSkge1xuICAgICAgY2FzZSBUcmFuc2FjdGlvbi5UWVBFUy5CVVlJTkc6XG4gICAgICAgIGFjY291bnQgPSBBY2NvdW50LmdldEFjY291bnQoKTtcbiAgICAgICAgYnV5ZXJVc2VySWQgPSBhY2NvdW50LmdldChcInVzZXJJZFwiKSB8fCBcIlwiO1xuICAgICAgICB0aGlzLnNldChcImJ1eWVyVXNlcklkXCIsIGJ1eWVyVXNlcklkKTtcblxuICAgICAgICBzd2l0Y2ggKCQoYVhtbE5vZGUpLmZpbmQoXCJCdXllclBhaWRTdGF0dXNcIikudGV4dCgpKSB7XG4gICAgICAgICAgY2FzZSBcIk1hcmtlZEFzUGFpZFwiOlxuICAgICAgICAgIGNhc2UgXCJQYWlkV2l0aEVzY3Jvd1wiOlxuICAgICAgICAgIGNhc2UgXCJQYWlkV2l0aFBhaXNhcGF5XCI6XG4gICAgICAgICAgY2FzZSBcIlBhaWRXaXRoUGFpc2FQYXlFc2Nyb3dcIjpcbiAgICAgICAgICBjYXNlIFwiUGFpZFdpdGhQYXlQYWxcIjpcbiAgICAgICAgICAgIHBhaWRTdGF0dXMgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHBhaWRTdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldChcImlzUGFpZEZvclwiLCBwYWlkU3RhdHVzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgVHJhbnNhY3Rpb24uVFlQRVMuU0VMTElORzpcbiAgICAgICAgYnV5ZXJVc2VySWQgPSAkKGFYbWxOb2RlKS5maW5kKFwiQnV5ZXJcIikuZmluZChcIlVzZXJJRFwiKS50ZXh0KCk7XG4gICAgICAgIHRoaXMuc2V0KFwiYnV5ZXJVc2VySWRcIiwgYnV5ZXJVc2VySWQpO1xuICAgICAgICB2YXIgcmVmdW5kZWQgPSBmYWxzZTtcblxuICAgICAgICBzd2l0Y2ggKCQoYVhtbE5vZGUpLmZpbmQoXCJTZWxsZXJQYWlkU3RhdHVzXCIpLnRleHQoKSkge1xuICAgICAgICAgIGNhc2UgXCJNYXJrZWRBc1BhaWRcIjpcbiAgICAgICAgICBjYXNlIFwiUGFpZFdpdGhFc2Nyb3dcIjpcbiAgICAgICAgICBjYXNlIFwiUGFpZFdpdGhQYWlzYXBheVwiOlxuICAgICAgICAgIGNhc2UgXCJQYWlkV2l0aFBhaXNhUGF5RXNjcm93XCI6XG4gICAgICAgICAgY2FzZSBcIlBhaWRXaXRoUGF5UGFsXCI6XG4gICAgICAgICAgICBwYWlkU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJSZWZ1bmRlZFwiOlxuICAgICAgICAgICAgcGFpZFN0YXR1cyA9IHRydWU7XG4gICAgICAgICAgICByZWZ1bmRlZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcGFpZFN0YXR1cyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0KFwiaXNQYWlkRm9yXCIsIHBhaWRTdGF0dXMpO1xuICAgICAgICB0aGlzLnNldChcImlzUmVmdW5kZWRcIiwgcmVmdW5kZWQpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB2YXIgaXNTaGlwcGVkID0gJChhWG1sTm9kZSkuZmluZChcIlNoaXBwZWRUaW1lXCIpLnRleHQoKS5sZW5ndGggPiAwO1xuICAgIHRoaXMuc2V0KFwiaXNTaGlwcGVkXCIsIGlzU2hpcHBlZCk7XG4gIH1cbn07XG4iXX0=