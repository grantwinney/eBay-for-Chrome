/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var CommonService = {
    _lasteBayTime: null,
    _eBayTimeOffset: null,
    _instanceIdentifier: null,
    _analyticsIdentifier: null,
    seteBayTime: function (aClaimedTime) {
        if (this._lasteBayTime && aClaimedTime < this._lasteBayTime) {
            return;
        }
        this._lasteBayTime = aClaimedTime;
        var ebayTime = aClaimedTime.getTime();
        var localTime = Date.now();
        this._eBayTimeOffset = ebayTime - localTime;
        PropertyDAO.set(PropertyDAO.PROP_TIME_OFFSET, this._eBayTimeOffset);
    },
    geteBayTime: function () {
        if (!this._eBayTimeOffset) {
            var storedOffset = PropertyDAO.get(PropertyDAO.PROP_TIME_OFFSET);
            this._eBayTimeOffset = (storedOffset !== null) ? Number(storedOffset) : 0;
        }
        return new Date(Date.now() + this._eBayTimeOffset);
    },
    getInstanceIdentifier: function () {
        if (!this._instanceIdentifier) {
            var storedIdentifier = PropertyDAO.get(PropertyDAO.PROP_INSTANCE_IDENTIFIER);
            if (!storedIdentifier) {
                this._instanceIdentifier = this._generateUUID();
                PropertyDAO.set(PropertyDAO.PROP_INSTANCE_IDENTIFIER, this._instanceIdentifier);
            }
            else {
                this._instanceIdentifier = storedIdentifier;
            }
        }
        return this._instanceIdentifier;
    },
    getAnalyticsIdentifier: function () {
        if (!this._analyticsIdentifier) {
            var storedIdentifier = PropertyDAO.get(PropertyDAO.PROP_ANALYTICS_IDENTIFIER);
            if (!storedIdentifier) {
                this._analyticsIdentifier = this._generateUUID();
                PropertyDAO.set(PropertyDAO.PROP_ANALYTICS_IDENTIFIER, this._analyticsIdentifier);
            }
            else {
                this._analyticsIdentifier = storedIdentifier;
            }
        }
        return this._analyticsIdentifier;
    },
    _generateUUID: function () {
        var uuid = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/[x]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        return uuid;
    },
    getRequestIdentifier: function () {
        var instanceIdentifier = this.getInstanceIdentifier();
        var timestamp = new Date().getTime();
        return instanceIdentifier + "*" + timestamp;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uU2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2JhY2tncm91bmQvY29yZS9zZXJ2aWNlcy9jb21tb25TZXJ2aWNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBVUgsSUFBSSxhQUFhLEdBQUc7SUFDbEIsYUFBYSxFQUFHLElBQUk7SUFDcEIsZUFBZSxFQUFHLElBQUk7SUFDdEIsbUJBQW1CLEVBQUcsSUFBSTtJQUMxQixvQkFBb0IsRUFBRyxJQUFJO0lBTTNCLFdBQVcsRUFBRyxVQUFTLFlBQVk7UUFHakMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDNUQsTUFBTSxDQUFDO1FBQ1QsQ0FBQztRQUNELElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDO1FBRWxDLElBQUksUUFBUSxHQUFHLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN0QyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFM0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxRQUFRLEdBQUcsU0FBUyxDQUFDO1FBQzVDLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBS0QsV0FBVyxFQUFHO1FBRVosRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztZQUUxQixJQUFJLFlBQVksR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2pFLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxZQUFZLEtBQUssSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1RSxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQU1ELHFCQUFxQixFQUFHO1FBRXRCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUU5QixJQUFJLGdCQUFnQixHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLHdCQUF3QixDQUFDLENBQUM7WUFDN0UsRUFBRSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ2hELFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLHdCQUF3QixFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ2xGLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixJQUFJLENBQUMsbUJBQW1CLEdBQUcsZ0JBQWdCLENBQUM7WUFDOUMsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQ2xDLENBQUM7SUFNRCxzQkFBc0IsRUFBRztRQUV2QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFL0IsSUFBSSxnQkFBZ0IsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBQzlFLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUNqRCxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNwRixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sSUFBSSxDQUFDLG9CQUFvQixHQUFHLGdCQUFnQixDQUFDO1lBQy9DLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztJQUNuQyxDQUFDO0lBTUQsYUFBYSxFQUFHO1FBRWQsSUFBSSxJQUFJLEdBQUcsc0NBQXNDLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxVQUFTLENBQUM7WUFDMUUsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFDLEVBQUUsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFDLEdBQUcsR0FBQyxHQUFHLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBTUQsb0JBQW9CLEVBQUc7UUFFckIsSUFBSSxrQkFBa0IsR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN0RCxJQUFJLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxrQkFBa0IsR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDO0lBQzlDLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgKEMpIDIwMDctMjAxNSBlQmF5IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqL1xuXG4vKlxuICB2YXIgTG9nZ2VyID0gcmVxdWlyZShcImhlbHBlcnMvbG9nZ2VyXCIpLkxvZ2dlcjtcbiAgdmFyIFByb3BlcnR5REFPID0gcmVxdWlyZShcInN0b3JhZ2UvcHJvcGVydHlEQU9cIikuUHJvcGVydHlEQU87XG4qL1xuXG4vKipcbiAqIENvbW1vbiBTZXJ2aWNlLlxuICovXG52YXIgQ29tbW9uU2VydmljZSA9IHtcbiAgX2xhc3RlQmF5VGltZSA6IG51bGwsXG4gIF9lQmF5VGltZU9mZnNldCA6IG51bGwsXG4gIF9pbnN0YW5jZUlkZW50aWZpZXIgOiBudWxsLFxuICBfYW5hbHl0aWNzSWRlbnRpZmllciA6IG51bGwsXG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGN1cnJlbnQgZUJheSB0aW1lLCBtYWtpbmcgc3VyZSB0aGF0IG5vdGhpbmcgdG9vIGZ1bmt5IGlzIGhhcHBlbmluZ1xuICAgKiB0aGF0IGNvdWxkIGNhdXNlIHZpc2libGUgdGltZS1qdW1wc1xuICAgKi9cbiAgc2V0ZUJheVRpbWUgOiBmdW5jdGlvbihhQ2xhaW1lZFRpbWUpIHtcbiAgICBcbiAgICAvLyBBdm9pZCBsZXR0aW5nIHRpbWUgZ28gYmFja3dhcmRzXG4gICAgaWYgKHRoaXMuX2xhc3RlQmF5VGltZSAmJiBhQ2xhaW1lZFRpbWUgPCB0aGlzLl9sYXN0ZUJheVRpbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fbGFzdGVCYXlUaW1lID0gYUNsYWltZWRUaW1lO1xuXG4gICAgdmFyIGViYXlUaW1lID0gYUNsYWltZWRUaW1lLmdldFRpbWUoKTtcbiAgICB2YXIgbG9jYWxUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIHRoaXMuX2VCYXlUaW1lT2Zmc2V0ID0gZWJheVRpbWUgLSBsb2NhbFRpbWU7XG4gICAgUHJvcGVydHlEQU8uc2V0KFByb3BlcnR5REFPLlBST1BfVElNRV9PRkZTRVQsIHRoaXMuX2VCYXlUaW1lT2Zmc2V0KTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBlQmF5IHRpbWUgYXMgYSBEYXRlIG9iamVjdFxuICAgKi9cbiAgZ2V0ZUJheVRpbWUgOiBmdW5jdGlvbigpIHtcbiAgICBcbiAgICBpZiAoIXRoaXMuX2VCYXlUaW1lT2Zmc2V0KSB7XG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgb2Zmc2V0IGZyb20gc3RvcmFnZSwgaWYgaXQgaXMgdGhlcmVcbiAgICAgIHZhciBzdG9yZWRPZmZzZXQgPSBQcm9wZXJ0eURBTy5nZXQoUHJvcGVydHlEQU8uUFJPUF9USU1FX09GRlNFVCk7XG4gICAgICB0aGlzLl9lQmF5VGltZU9mZnNldCA9IChzdG9yZWRPZmZzZXQgIT09IG51bGwpID8gTnVtYmVyKHN0b3JlZE9mZnNldCkgOiAwO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSArIHRoaXMuX2VCYXlUaW1lT2Zmc2V0KTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgXCJ1bmlxdWVcIiBpbnN0YW5jZSBpZGVudGlmaWVyIChpZiBzdG9yZWQpIG9yIGdlbmVyYXRlcyBhbmRcbiAgICogc3RvcmVzIG9uZVxuICAgKi9cbiAgZ2V0SW5zdGFuY2VJZGVudGlmaWVyIDogZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgaWYgKCF0aGlzLl9pbnN0YW5jZUlkZW50aWZpZXIpIHtcbiAgICAgIC8vIFJldHJpZXZlIHRoZSBpZGVudGlmaWVyIGZyb20gc3RvcmFnZSwgaWYgaXQgaXMgdGhlcmVcbiAgICAgIHZhciBzdG9yZWRJZGVudGlmaWVyID0gUHJvcGVydHlEQU8uZ2V0KFByb3BlcnR5REFPLlBST1BfSU5TVEFOQ0VfSURFTlRJRklFUik7XG4gICAgICBpZiAoIXN0b3JlZElkZW50aWZpZXIpIHtcbiAgICAgICAgdGhpcy5faW5zdGFuY2VJZGVudGlmaWVyID0gdGhpcy5fZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgIFByb3BlcnR5REFPLnNldChQcm9wZXJ0eURBTy5QUk9QX0lOU1RBTkNFX0lERU5USUZJRVIsIHRoaXMuX2luc3RhbmNlSWRlbnRpZmllcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pbnN0YW5jZUlkZW50aWZpZXIgPSBzdG9yZWRJZGVudGlmaWVyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VJZGVudGlmaWVyO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBcInVuaXF1ZVwiIGFuYWx5dGljcyBpZGVudGlmaWVyIChpZiBzdG9yZWQpIG9yIGdlbmVyYXRlcyBhbmRcbiAgICogc3RvcmVzIG9uZSBmb3IgQW5hbHl0aWNzXG4gICAqL1xuICBnZXRBbmFseXRpY3NJZGVudGlmaWVyIDogZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgaWYgKCF0aGlzLl9hbmFseXRpY3NJZGVudGlmaWVyKSB7XG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgaWRlbnRpZmllciBmcm9tIHN0b3JhZ2UsIGlmIGl0IGlzIHRoZXJlXG4gICAgICB2YXIgc3RvcmVkSWRlbnRpZmllciA9IFByb3BlcnR5REFPLmdldChQcm9wZXJ0eURBTy5QUk9QX0FOQUxZVElDU19JREVOVElGSUVSKTtcbiAgICAgIGlmICghc3RvcmVkSWRlbnRpZmllcikge1xuICAgICAgICB0aGlzLl9hbmFseXRpY3NJZGVudGlmaWVyID0gdGhpcy5fZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgIFByb3BlcnR5REFPLnNldChQcm9wZXJ0eURBTy5QUk9QX0FOQUxZVElDU19JREVOVElGSUVSLCB0aGlzLl9hbmFseXRpY3NJZGVudGlmaWVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2FuYWx5dGljc0lkZW50aWZpZXIgPSBzdG9yZWRJZGVudGlmaWVyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fYW5hbHl0aWNzSWRlbnRpZmllcjtcbiAgfSxcblxuICAvKipcbiAgICogR2VuZXJhdGVzIGEgVVVJRC5cbiAgICogQHJldHVybiBhbiBVVUlELlxuICAgKi9cbiAgX2dlbmVyYXRlVVVJRCA6IGZ1bmN0aW9uKCkge1xuICAgIFxuICAgIHZhciB1dWlkID0gJ3h4eHh4eHh4LXh4eHgteHh4eC14eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3hdL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSoxNnwwLCB2ID0gYyA9PSAneCcgPyByIDogKHImMHgzfDB4OCk7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdXVpZDtcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyB0aGUgaWRlbnRpZmllciB0byBiZSBzZW50IHdpdGggZWFjaCBUcmFkaW5nIEFQSSByZXF1ZXN0LiBJdCBpcyBhXG4gICAqIGNvbWJpbmF0aW9uIG9mIHRoZSBpbnN0YW5jZSBpZGVudGlmaWVyIGFuZCBhIHRpbWVzdGFtcFxuICAgKi9cbiAgZ2V0UmVxdWVzdElkZW50aWZpZXIgOiBmdW5jdGlvbigpIHtcbiAgICBcbiAgICB2YXIgaW5zdGFuY2VJZGVudGlmaWVyID0gdGhpcy5nZXRJbnN0YW5jZUlkZW50aWZpZXIoKTtcbiAgICB2YXIgdGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgcmV0dXJuIGluc3RhbmNlSWRlbnRpZmllciArIFwiKlwiICsgdGltZXN0YW1wO1xuICB9XG59O1xuIl19