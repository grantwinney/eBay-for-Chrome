/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var ApiHelper = {
    _lastRequestIndex: -1,
    _pendingRequests: {},
    addPendingRequest: function (aRequest, aRequestName, aTopic) {
        var TIMEOUT_ERROR_MSG = "Call timed out after " + (PropertyDAO.get(PropertyDAO.PROP_API_TIMEOUT) / 1000) + " seconds";
        var requestIndex = this._lastRequestIndex++;
        var timeout = new Timer(function () {
            if (aRequestName.indexOf("deactivateUserOnDevice") == -1) {
                Logger.error(aRequestName + ": " + TIMEOUT_ERROR_MSG);
                aRequest.abort();
                if (aTopic) {
                    ObserverHelper.notify(aTopic);
                }
            }
        }, PropertyDAO.get(PropertyDAO.PROP_API_TIMEOUT));
        this._pendingRequests[requestIndex] = {
            request: aRequest, timeout: timeout, requestName: aRequestName
        };
        aRequest.done(function () {
            this.removePendingRequest(requestIndex, aRequestName);
        }.bind(this));
        aRequest.fail(function () {
            this.removePendingRequest(requestIndex, aRequestName);
        }.bind(this));
        return requestIndex;
    },
    removePendingRequest: function (aRequestIndex, aRequestName) {
        if (!this._pendingRequests[aRequestIndex]) {
            if (aRequestName.indexOf("deactivateUserOnDevice") == -1) {
                Logger.error("Attempt to remove a request that isn't in the list of " +
                    "pending requests (" + aRequestName + ")!");
            }
            return;
        }
        this._pendingRequests[aRequestIndex].timeout.cancel();
        delete this._pendingRequests[aRequestIndex];
    },
    abortPendingRequests: function () {
        $.each(this._pendingRequests, function () {
            if (this.requestName.indexOf("deactivateUserOnDevice") == -1) {
                this.timeout.cancel();
                this.request.abort();
            }
        });
        this._lastRequestIndex = -1;
        this._pendingRequests = {};
    },
    getEndPoint: function (endPoint) {
        var servicesLocation = PropertyDAO.get(PropertyDAO.PROP_SERVICES_LOCATION);
        if (!servicesLocation) {
            servicesLocation = "production";
        }
        return _.get(Configs.END_POINTS, [endPoint, servicesLocation]);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpSGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vYmFja2dyb3VuZC9jb3JlL2hlbHBlcnMvYXBpSGVscGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBV0gsSUFBSSxTQUFTLEdBQUc7SUFFZCxpQkFBaUIsRUFBRSxDQUFDLENBQUM7SUFFckIsZ0JBQWdCLEVBQUUsRUFBRTtJQVdwQixpQkFBaUIsRUFBRyxVQUFTLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTTtRQUV6RCxJQUFNLGlCQUFpQixHQUNyQix1QkFBdUIsR0FBRyxDQUFFLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsSUFBSSxDQUFFLEdBQUcsVUFBVSxDQUFDO1FBSWxHLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQzVDLElBQUksT0FBTyxHQUNULElBQUksS0FBSyxDQUFDO1lBQ0UsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekQsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsSUFBSSxHQUFHLGlCQUFpQixDQUFDLENBQUM7Z0JBQ3RELFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDakIsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDWCxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNoQyxDQUFDO1lBRUgsQ0FBQztRQUNILENBQUMsRUFBRSxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxHQUFHO1lBQ3BDLE9BQU8sRUFBRyxRQUFRLEVBQUUsT0FBTyxFQUFHLE9BQU8sRUFBRSxXQUFXLEVBQUcsWUFBWTtTQUNsRSxDQUFDO1FBSUYsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNaLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2QsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNaLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRWQsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBU0Qsb0JBQW9CLEVBQUcsVUFBUyxhQUFhLEVBQUUsWUFBWTtRQUd6RCxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUMsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekQsTUFBTSxDQUFDLEtBQUssQ0FBQyx3REFBd0Q7b0JBQ3hELG9CQUFvQixHQUFHLFlBQVksR0FBRyxJQUFJLENBQUMsQ0FBQztZQUMzRCxDQUFDO1lBQ0QsTUFBTSxDQUFDO1FBQ1QsQ0FBQztRQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDdEQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUtELG9CQUFvQixFQUFHO1FBRXJCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBRTVCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM3RCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN0QixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ3ZCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxXQUFXLEVBQUUsVUFBUyxRQUFRO1FBQzVCLElBQUksZ0JBQWdCLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUMzRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUN0QixnQkFBZ0IsR0FBRyxZQUFZLENBQUM7UUFDbEMsQ0FBQztRQUVELE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgKEMpIDIwMDctMjAxNSBlQmF5IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqL1xuXG4vKlxuICB2YXIgQ29uZmlncyA9IHJlcXVpcmUoXCJjb3JlL2NvbmZpZ3MvaW5pdFwiKS5Db25maWdzO1xuICB2YXIgTG9nZ2VyID0gcmVxdWlyZShcImhlbHBlcnMvbG9nZ2VyXCIpLkxvZ2dlcjtcbiAgdmFyIFRvcGljcyA9IHJlcXVpcmUoXCJoZWxwZXJzL29ic2VydmVySGVscGVyXCIpLlRvcGljcztcbiAgdmFyIE9ic2VydmVySGVscGVyID0gcmVxdWlyZShcImhlbHBlcnMvb2JzZXJ2ZXJIZWxwZXJcIikuT2JzZXJ2ZXJIZWxwZXI7XG4gIHZhciBUaW1lciA9IHJlcXVpcmUoXCJoZWxwZXJzL3RpbWVyXCIpLlRpbWVyO1xuICB2YXIgUHJvcGVydHlEQU8gPSByZXF1aXJlKFwic3RvcmFnZS9wcm9wZXJ0eURBT1wiKS5Qcm9wZXJ0eURBTztcbiovXG5cbnZhciBBcGlIZWxwZXIgPSB7XG4gIC8qIFRoZSBsYXN0IHJlcXVlc3QgaW5kZXguICovXG4gIF9sYXN0UmVxdWVzdEluZGV4OiAtMSxcbiAgLyogQW4gb2JqZWN0IGNvbnRhaW5zIGEgbGlzdCBvZiBwZW5kaW5nIHJlcXVlc3RzLiAqL1xuICBfcGVuZGluZ1JlcXVlc3RzOiB7fSxcblxuICAvKipcbiAgICogQWRkcyB0aGUgZ2l2ZW4gcmVxdWVzdCB0byB0aGUgbGlzdCBvZiBwZW5kaW5nIHJlcXVlc3RzIGFuZCBzdGFydHMgYSB0aW1lci5cbiAgICogVGhlIHJlcXVlc3Qgd2lsbCBhdXRvbWF0aWNhbGx5IHRpbWUtb3V0IGFuZCBjYW5jZWwgYWZ0ZXIgYSBwcmVzZXQgaW50ZXJ2YWwuXG4gICAqIEBwYXJhbSBhUmVxdWVzdCBYTUxIdHRwUmVxdWVzdCBvYmplY3QgdG8gdHJhY2tcbiAgICogQHBhcmFtIGFSZXF1ZXN0TmFtZSBOYW1lIG9mIHRoZSByZXF1ZXN0XG4gICAqIEBwYXJhbSBhVG9waWMgVG9waWMgdG8gbm90aWZ5XG4gICAqIEByZXR1cm4gQW4gSUQgdGhhdCBpZGVudGlmaWVzIHRoZSByZXF1ZXN0LiAgSXQgY2FuIGJlIHVzZWQgdG8gdW50cmFjayB0aGVcbiAgICogcmVxdWVzdFxuICAgKi9cbiAgYWRkUGVuZGluZ1JlcXVlc3QgOiBmdW5jdGlvbihhUmVxdWVzdCwgYVJlcXVlc3ROYW1lLCBhVG9waWMpIHtcbiAgICBcbiAgICBjb25zdCBUSU1FT1VUX0VSUk9SX01TRyA9XG4gICAgICBcIkNhbGwgdGltZWQgb3V0IGFmdGVyIFwiICsgKCBQcm9wZXJ0eURBTy5nZXQoUHJvcGVydHlEQU8uUFJPUF9BUElfVElNRU9VVCkgLyAxMDAwICkgKyBcIiBzZWNvbmRzXCI7XG5cbiAgICAvLyBLZWVwIHJlZmVyZW5jZSB0byByZXF1ZXN0IHVudGlsIGl0J3MgcmV0dXJuZWQsIHNvIHRoYXQgaXQgY2FuIGJlXG4gICAgLy8gY2FuY2VsbGVkIGlmIG5lY2Vzc2FyeSwgYW5kIHByZXBhcmUgdGltZW91dC5cbiAgICB2YXIgcmVxdWVzdEluZGV4ID0gdGhpcy5fbGFzdFJlcXVlc3RJbmRleCsrO1xuICAgIHZhciB0aW1lb3V0ID1cbiAgICAgIG5ldyBUaW1lcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChhUmVxdWVzdE5hbWUuaW5kZXhPZihcImRlYWN0aXZhdGVVc2VyT25EZXZpY2VcIikgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgTG9nZ2VyLmVycm9yKGFSZXF1ZXN0TmFtZSArIFwiOiBcIiArIFRJTUVPVVRfRVJST1JfTVNHKTtcbiAgICAgICAgICAgICAgICAgICAgYVJlcXVlc3QuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFUb3BpYykge1xuICAgICAgICAgICAgICAgICAgICAgIE9ic2VydmVySGVscGVyLm5vdGlmeShhVG9waWMpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBQcm9wZXJ0eURBTy5nZXQoUHJvcGVydHlEQU8uUFJPUF9BUElfVElNRU9VVCkpO1xuICAgIHRoaXMuX3BlbmRpbmdSZXF1ZXN0c1tyZXF1ZXN0SW5kZXhdID0ge1xuICAgICAgcmVxdWVzdCA6IGFSZXF1ZXN0LCB0aW1lb3V0IDogdGltZW91dCwgcmVxdWVzdE5hbWUgOiBhUmVxdWVzdE5hbWVcbiAgICB9O1xuXG4gICAgLy8gQWRkIGNhbGxiYWNrIHRvIHJlcXVlc3Qgc28gdGhhdCBpdCBjYW4gYmUgcmVtb3ZlZCBmcm9tIHRoZSBsaXN0IHdoZW4gaXRcbiAgICAvLyByZXR1cm5zLlxuICAgIGFSZXF1ZXN0LmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnJlbW92ZVBlbmRpbmdSZXF1ZXN0KHJlcXVlc3RJbmRleCwgYVJlcXVlc3ROYW1lKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICAgIGFSZXF1ZXN0LmZhaWwoZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnJlbW92ZVBlbmRpbmdSZXF1ZXN0KHJlcXVlc3RJbmRleCwgYVJlcXVlc3ROYW1lKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgcmV0dXJuIHJlcXVlc3RJbmRleDtcbiAgfSxcblxuICAvKipcbiAgICogUmVtb3ZlcyB0aGUgcmVxdWVzdCB3aXRoIHRoZSBnaXZlbiB0cmFja2luZyBJRCBmcm9tIHRoZSBsaXN0IG9mIHBlbmRpbmdcbiAgICogcmVxdWVzdHMgYW5kIGFib3J0cyB0aGUgdGltZW91dCB0aW1lci5cbiAgICogQHBhcmFtIGFSZXF1ZXN0SW5kZXggSUQgdGhhdCBpZGVudGlmaWVzIHRoZSByZXF1ZXN0LCBwcm92aWRlZCBieVxuICAgKiAgYWRkUGVuZGluZ1JlcXVlc3RcbiAgICogQHBhcmFtIGFSZXF1ZXN0TmFtZSB0aGUgcmVxdWVzdCBuYW1lXG4gICAqL1xuICByZW1vdmVQZW5kaW5nUmVxdWVzdCA6IGZ1bmN0aW9uKGFSZXF1ZXN0SW5kZXgsIGFSZXF1ZXN0TmFtZSkge1xuICAgIFxuICAgIC8vIGlnbm9yZSBkZWFjdGl2YXRlVXNlck9uRGV2aWNlIHJlcXVlc3RzXG4gICAgaWYgKCF0aGlzLl9wZW5kaW5nUmVxdWVzdHNbYVJlcXVlc3RJbmRleF0pIHtcbiAgICAgIGlmIChhUmVxdWVzdE5hbWUuaW5kZXhPZihcImRlYWN0aXZhdGVVc2VyT25EZXZpY2VcIikgPT0gLTEpIHtcbiAgICAgICAgTG9nZ2VyLmVycm9yKFwiQXR0ZW1wdCB0byByZW1vdmUgYSByZXF1ZXN0IHRoYXQgaXNuJ3QgaW4gdGhlIGxpc3Qgb2YgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgXCJwZW5kaW5nIHJlcXVlc3RzIChcIiArIGFSZXF1ZXN0TmFtZSArIFwiKSFcIik7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3BlbmRpbmdSZXF1ZXN0c1thUmVxdWVzdEluZGV4XS50aW1lb3V0LmNhbmNlbCgpO1xuICAgIGRlbGV0ZSB0aGlzLl9wZW5kaW5nUmVxdWVzdHNbYVJlcXVlc3RJbmRleF07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEFib3J0cyBhbGwgcGVuZGluZyByZXF1ZXN0c1xuICAgKi9cbiAgYWJvcnRQZW5kaW5nUmVxdWVzdHMgOiBmdW5jdGlvbigpIHtcbiAgICBcbiAgICAkLmVhY2godGhpcy5fcGVuZGluZ1JlcXVlc3RzLCBmdW5jdGlvbigpIHtcbiAgICAgIC8vIGRvIG5vdCBjYW5jZWwgZGVhY3RpdmF0ZVVzZXJPbkRldmljZSByZXF1ZXN0cyB3aGVuIHRoZSB1c2VyIHNpZ25zIG91dFxuICAgICAgaWYgKHRoaXMucmVxdWVzdE5hbWUuaW5kZXhPZihcImRlYWN0aXZhdGVVc2VyT25EZXZpY2VcIikgPT0gLTEpIHtcbiAgICAgICAgdGhpcy50aW1lb3V0LmNhbmNlbCgpO1xuICAgICAgICB0aGlzLnJlcXVlc3QuYWJvcnQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuX2xhc3RSZXF1ZXN0SW5kZXggPSAtMTtcbiAgICB0aGlzLl9wZW5kaW5nUmVxdWVzdHMgPSB7fTtcbiAgfSxcblxuICBnZXRFbmRQb2ludDogZnVuY3Rpb24oZW5kUG9pbnQpIHtcbiAgICB2YXIgc2VydmljZXNMb2NhdGlvbiA9IFByb3BlcnR5REFPLmdldChQcm9wZXJ0eURBTy5QUk9QX1NFUlZJQ0VTX0xPQ0FUSU9OKTtcbiAgICBpZiAoIXNlcnZpY2VzTG9jYXRpb24pIHtcbiAgICAgIHNlcnZpY2VzTG9jYXRpb24gPSBcInByb2R1Y3Rpb25cIjtcbiAgICB9XG5cbiAgICByZXR1cm4gXy5nZXQoQ29uZmlncy5FTkRfUE9JTlRTLCBbZW5kUG9pbnQsIHNlcnZpY2VzTG9jYXRpb25dKTtcbiAgfVxufTtcbiJdfQ==