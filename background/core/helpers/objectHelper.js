/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var ObjectHelper = {
    getTypedValue: function (aType, aValue) {
        var value;
        if (undefined === aValue || null === aValue) {
            value = null;
        }
        else {
            switch (aType) {
                case "number":
                    if (isNaN(aValue)) {
                        value = null;
                    }
                    else {
                        value = Number(aValue);
                    }
                    break;
                case "boolean":
                    switch (typeof (aValue)) {
                        case "boolean":
                            value = Boolean(aValue);
                            break;
                        case "string":
                            if ("true" == aValue) {
                                value = true;
                            }
                            else if ("false" == aValue) {
                                value = false;
                            }
                            else {
                                value = false;
                            }
                            break;
                        default:
                            value = false;
                            break;
                    }
                    break;
                case "string":
                    value = String(aValue);
                    break;
                case "listingFormat":
                    value = aValue;
                    break;
                case "object":
                    value = aValue;
                    break;
                default:
                    value = aValue;
                    break;
            }
        }
        return value;
    },
    copyObject: function (aObject, aClass) {
        var object = new aClass();
        for (var name in aClass.SCHEMA.PROPERTIES) {
            object.set(name, aObject.get(name));
        }
        return object;
    },
    updateTo: function (aCurObject, aNewObject, aSchema) {
        var modifiedFields = [];
        var curValue;
        var newValue;
        for (var name in aSchema.PROPERTIES) {
            curValue = aCurObject.get(name);
            newValue = aNewObject.get(name);
            if (newValue !== undefined && newValue !== null &&
                curValue != newValue) {
                aCurObject.set(name, newValue);
                modifiedFields[modifiedFields.length] = name;
            }
        }
        return modifiedFields.length > 0 ? modifiedFields : null;
    },
    updateWithJSON: function (aObject, aJSON, aSchema) {
        $.each(aSchema.PROPERTIES, function (aName) {
            aObject.set(aName, aJSON[aName]);
        });
    },
    fromXML: function (aXMLNode, aClass, aExclusivePrefix) {
        var object = new aClass();
        var xmlName = null;
        var xmlValue = null;
        var that = this;
        $.each(aClass.SCHEMA.PROPERTIES, function (aName, aInfo) {
            xmlName = null;
            if (aInfo.xml !== "") {
                if (aExclusivePrefix) {
                    if (aInfo.xml.indexOf(aExclusivePrefix) === 0) {
                        xmlName = aInfo.xml.substring(aExclusivePrefix.length + 1);
                    }
                }
                else {
                    xmlName = aInfo.xml;
                }
                if (xmlName !== null) {
                    xmlValue = that._getXMLValue(aXMLNode, xmlName);
                    if (xmlValue && xmlValue !== null && xmlValue !== "") {
                        object.set(aName, xmlValue);
                    }
                    else {
                        object.set(aName, aInfo.defaultValue);
                    }
                }
            }
        });
        return object;
    },
    _getXMLValue: function (aXMLTree, aXMLName) {
        var xmlNames = aXMLName.split("|");
        var xmlValue = null;
        $.each(xmlNames, function (aNameIndex, aName) {
            var xmlFields = aName.split(".");
            var xmlNode = aXMLTree;
            $.each(xmlFields, function (aFieldIndex, aField) {
                if (aField[0] != "@") {
                    var arrayStart = aField.indexOf('[');
                    if (arrayStart != -1) {
                        var arrayIndex = aField.substring(arrayStart + 1, aField.indexOf(']'));
                        aField = aField.substring(0, arrayStart);
                        xmlNode = $(xmlNode).children(aField).eq(arrayIndex);
                    }
                    else {
                        xmlNode = $(xmlNode).children(aField);
                    }
                    if (xmlNode.length === 0) {
                        return false;
                    }
                }
                else {
                    xmlNode = $(xmlNode);
                }
            });
            if (xmlNode.length > 0) {
                if (xmlFields[(xmlFields.length - 1)][0] == "@") {
                    var xmlAttr = xmlFields[(xmlFields.length - 1)].substring(1);
                    xmlValue = $(xmlNode).attr(xmlAttr);
                }
                else {
                    xmlValue = $(xmlNode).text();
                }
                return false;
            }
        });
        return xmlValue;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0SGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vYmFja2dyb3VuZC9jb3JlL2hlbHBlcnMvb2JqZWN0SGVscGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBRUgsSUFBSSxZQUFZLEdBQUc7SUFPakIsYUFBYSxFQUFHLFVBQVMsS0FBSyxFQUFFLE1BQU07UUFDcEMsSUFBSSxLQUFLLENBQUM7UUFFVixFQUFFLENBQUMsQ0FBQyxTQUFTLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzVDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDZixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNkLEtBQUssUUFBUTtvQkFDWCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNsQixLQUFLLEdBQUcsSUFBSSxDQUFDO29CQUNmLENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ04sS0FBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDekIsQ0FBQztvQkFDRCxLQUFLLENBQUM7Z0JBQ1IsS0FBSyxTQUFTO29CQUNaLE1BQU0sQ0FBQyxDQUFDLE9BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3ZCLEtBQUssU0FBUzs0QkFDWixLQUFLLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDOzRCQUN4QixLQUFLLENBQUM7d0JBQ1IsS0FBSyxRQUFROzRCQUNYLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO2dDQUNyQixLQUFLLEdBQUcsSUFBSSxDQUFDOzRCQUNmLENBQUM7NEJBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxNQUFNLENBQUMs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Q0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN2QixDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7WUFDSCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUMvQyxJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM1RCxRQUFRLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDdEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixRQUFRLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUMvQixDQUFDO2dCQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDZixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQ2xCLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgKEMpIDIwMDctMjAxNSBlQmF5IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqL1xuXG52YXIgT2JqZWN0SGVscGVyID0ge1xuICAvKipcbiAgICogR2V0cyB0aGUgdHlwZWQgdmFsdWUuXG4gICAqIEBwYXJhbSBhVHlwZSB0aGUgdHlwZSBvZiB0aGUgdmFsdWUuXG4gICAqIEBwYXJhbSBhVmFsdWUgdGhlIHZhbHVlLlxuICAgKiBAcmV0dXJuIHRoZSB0eXBlZCB2YWx1ZS5cbiAgICovXG4gIGdldFR5cGVkVmFsdWUgOiBmdW5jdGlvbihhVHlwZSwgYVZhbHVlKSB7XG4gICAgdmFyIHZhbHVlO1xuXG4gICAgaWYgKHVuZGVmaW5lZCA9PT0gYVZhbHVlIHx8IG51bGwgPT09IGFWYWx1ZSkge1xuICAgICAgdmFsdWUgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2l0Y2ggKGFUeXBlKSB7XG4gICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgICBpZiAoaXNOYU4oYVZhbHVlKSkge1xuICAgICAgICAgICAgdmFsdWUgPSBudWxsO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9IE51bWJlcihhVmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgICBzd2l0Y2ggKHR5cGVvZihhVmFsdWUpKSB7XG4gICAgICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgICB2YWx1ZSA9IEJvb2xlYW4oYVZhbHVlKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICAgIGlmIChcInRydWVcIiA9PSBhVmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRydWU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXCJmYWxzZVwiID09IGFWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgIHZhbHVlID0gU3RyaW5nKGFWYWx1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsaXN0aW5nRm9ybWF0XCI6XG4gICAgICAgICAgdmFsdWUgPSBhVmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJvYmplY3RcIjpcbiAgICAgICAgICB2YWx1ZSA9IGFWYWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB2YWx1ZSA9IGFWYWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoZSBwYXJhbSBvYmplY3QuXG4gICAqIEBwYXJhbSBhT2JqZWN0IHRoZSBvYmplY3QgdG8gYmUgY29waWVkLlxuICAgKiBAcGFyYW0gYUNsYXNzIHRoZSBvYmplY3QncyBjbGFzcy5cbiAgICogQHJldHVybiB0aGUgb2JqZWN0IGNvcHkuXG4gICAqL1xuICBjb3B5T2JqZWN0IDogZnVuY3Rpb24oYU9iamVjdCwgYUNsYXNzKSB7XG4gICAgdmFyIG9iamVjdCA9IG5ldyBhQ2xhc3MoKTtcblxuICAgIGZvciAodmFyIG5hbWUgaW4gYUNsYXNzLlNDSEVNQS5QUk9QRVJUSUVTKSB7XG4gICAgICBvYmplY3Quc2V0KG5hbWUsIGFPYmplY3QuZ2V0KG5hbWUpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0O1xuICB9LFxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIG9uZSBEVE8gdG8gYW5vdGhlci5cbiAgICogQHBhcmFtIGFDdXJPYmplY3QgdGhlIGN1cnJlbnQgRFRPLlxuICAgKiBAcGFyYW0gYU5ld09iamVjdCB0aGUgbmV3IERUTy5cbiAgICogQHBhcmFtIGFTY2hlbWEgdGhlIERUTyBzY2hlbWEuXG4gICAqIEByZXR1cm4gdGhlIG1vZGlmaWVkIGZpZWxkcywgaWYgYW55LlxuICAgKi9cbiAgdXBkYXRlVG8gOiBmdW5jdGlvbihhQ3VyT2JqZWN0LCBhTmV3T2JqZWN0LCBhU2NoZW1hKSB7XG4gICAgdmFyIG1vZGlmaWVkRmllbGRzID0gW107XG4gICAgdmFyIGN1clZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZTtcblxuICAgIGZvciAodmFyIG5hbWUgaW4gYVNjaGVtYS5QUk9QRVJUSUVTKSB7XG4gICAgICBjdXJWYWx1ZSA9IGFDdXJPYmplY3QuZ2V0KG5hbWUpO1xuICAgICAgbmV3VmFsdWUgPSBhTmV3T2JqZWN0LmdldChuYW1lKTtcblxuICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG51bGwgJiZcbiAgICAgICAgICBjdXJWYWx1ZSAhPSBuZXdWYWx1ZSkge1xuICAgICAgICBhQ3VyT2JqZWN0LnNldChuYW1lLCBuZXdWYWx1ZSk7XG4gICAgICAgIC8vWFhYOiB1c2UgdGhpcyBpbnN0ZWFkIG9mIHB1c2gsIHNpbmNlIHRoZXJlIHNlZW1zIHRvIGJlIGEgYnVnIHdpdGggaXRcbiAgICAgICAgLy8gaW5zaWRlICQuZWFjaCBzdGF0ZW1lbnRzLlxuICAgICAgICBtb2RpZmllZEZpZWxkc1ttb2RpZmllZEZpZWxkcy5sZW5ndGhdID0gbmFtZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbW9kaWZpZWRGaWVsZHMubGVuZ3RoID4gMCA/IG1vZGlmaWVkRmllbGRzIDogbnVsbDtcbiAgfSxcblxuICAvKipcbiAgICogVXBkYXRlcyBvbmUgRFRPIG9iamVjdCB3aXRoIGEgSlNPTiBvYmplY3QuXG4gICAqIEBwYXJhbSBhT2JqZWN0IHRoZSBEVE8uXG4gICAqIEBwYXJhbSBhSlNPTiB0aGUgSlNPTi5cbiAgICogQHBhcmFtIGFTY2hlbWEgdGhlIERUTyBzY2hlbWEuXG4gICAqL1xuICB1cGRhdGVXaXRoSlNPTiA6IGZ1bmN0aW9uKGFPYmplY3QsIGFKU09OLCBhU2NoZW1hKSB7XG4gICAgJC5lYWNoKGFTY2hlbWEuUFJPUEVSVElFUywgZnVuY3Rpb24oYU5hbWUpIHtcbiAgICAgIGFPYmplY3Quc2V0KGFOYW1lLCBhSlNPTlthTmFtZV0pO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBQb3B1bGF0ZXMgYW4gb2JqZWN0IGZyb20gYSBYTUwuXG4gICAqIEBwYXJhbSBhWE1MTm9kZSB0aGUgeG1sIG5vZGUuXG4gICAqIEBwYXJhbSBhQ2xhc3MgdGhlIG9iamVjdCBjbGFzcy5cbiAgICogQHBhcmFtIGFFeGNsdXNpdmVQcmVmaXggWE1MIHByZWZpeC5cbiAgICogQHJldHVybiB0aGUgcG9wdWxhdGVkIG9iamVjdCBmcm9tIHRoZSB4bWwuXG4gICAqL1xuICBmcm9tWE1MIDogZnVuY3Rpb24oYVhNTE5vZGUsIGFDbGFzcywgYUV4Y2x1c2l2ZVByZWZpeCkge1xuICAgIHZhciBvYmplY3QgPSBuZXcgYUNsYXNzKCk7XG4gICAgdmFyIHhtbE5hbWUgPSBudWxsO1xuICAgIHZhciB4bWxWYWx1ZSA9IG51bGw7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgJC5lYWNoKGFDbGFzcy5TQ0hFTUEuUFJPUEVSVElFUywgZnVuY3Rpb24oYU5hbWUsIGFJbmZvKSB7XG4gICAgICB4bWxOYW1lID0gbnVsbDtcbiAgICAgIGlmIChhSW5mby54bWwgIT09IFwiXCIpIHtcbiAgICAgICAgaWYgKGFFeGNsdXNpdmVQcmVmaXgpIHtcbiAgICAgICAgICBpZiAoYUluZm8ueG1sLmluZGV4T2YoYUV4Y2x1c2l2ZVByZWZpeCkgPT09IDApIHtcbiAgICAgICAgICAgIHhtbE5hbWUgPSBhSW5mby54bWwuc3Vic3RyaW5nKGFFeGNsdXNpdmVQcmVmaXgubGVuZ3RoKzEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB4bWxOYW1lID0gYUluZm8ueG1sO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHhtbE5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICB4bWxWYWx1ZSA9IHRoYXQuX2dldFhNTFZhbHVlKGFYTUxOb2RlLCB4bWxOYW1lKTtcbiAgICAgICAgICBpZiAoeG1sVmFsdWUgJiYgeG1sVmFsdWUgIT09IG51bGwgJiYgeG1sVmFsdWUgIT09IFwiXCIpIHtcbiAgICAgICAgICAgIG9iamVjdC5zZXQoYU5hbWUsIHhtbFZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqZWN0LnNldChhTmFtZSwgYUluZm8uZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBvYmplY3Q7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgYSB2YWx1ZSBmcm9tIGFuIFhNTCBub2RlLCBnaXZlbiBpdHMgbmFtZShzKSBzZXBhcmF0ZWQgYnkgJ3wnLlxuICAgKiBJdCBhbGxvd3MgbmVzdGVkIHRhZ3MsIHVzaW5nICcuJyBhcyBhIHNlcGFyYXRvciBhbmQgQCBmb3IgYXR0cmlidXRlcy5cbiAgICogQHBhcmFtIGFYTUxUcmVlIHRoZSBYTUwgbm9kZSB0byB0cmF2ZXJzZS5cbiAgICogQHBhcmFtIGFYTUxOYW1lIHRoZSB0YWcgbmFtZSB0byBmaW5kXG4gICAqL1xuICBfZ2V0WE1MVmFsdWUgOiBmdW5jdGlvbihhWE1MVHJlZSwgYVhNTE5hbWUpIHtcbiAgICB2YXIgeG1sTmFtZXMgPSBhWE1MTmFtZS5zcGxpdChcInxcIik7XG4gICAgdmFyIHhtbFZhbHVlID0gbnVsbDtcblxuICAgICQuZWFjaCh4bWxOYW1lcywgZnVuY3Rpb24oYU5hbWVJbmRleCwgYU5hbWUpIHtcbiAgICAgIHZhciB4bWxGaWVsZHMgPSBhTmFtZS5zcGxpdChcIi5cIik7XG4gICAgICB2YXIgeG1sTm9kZSA9IGFYTUxUcmVlO1xuXG4gICAgICAkLmVhY2goeG1sRmllbGRzLCBmdW5jdGlvbihhRmllbGRJbmRleCwgYUZpZWxkKSB7XG4gICAgICAgIGlmIChhRmllbGRbMF0gIT0gXCJAXCIpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiBmaWVsZCBuYW1lIGNvbnRhaW5zIGFuIGFycmF5IG5vdGF0aW9uXG4gICAgICAgICAgdmFyIGFycmF5U3RhcnQgPSBhRmllbGQuaW5kZXhPZignWycpO1xuICAgICAgICAgIGlmIChhcnJheVN0YXJ0ICE9IC0xKSB7XG4gICAgICAgICAgICB2YXIgYXJyYXlJbmRleCA9IGFGaWVsZC5zdWJzdHJpbmcoYXJyYXlTdGFydCsxLCBhRmllbGQuaW5kZXhPZignXScpKTtcbiAgICAgICAgICAgIGFGaWVsZCA9IGFGaWVsZC5zdWJzdHJpbmcoMCxhcnJheVN0YXJ0KTtcbiAgICAgICAgICAgIHhtbE5vZGUgPSAkKHhtbE5vZGUpLmNoaWxkcmVuKGFGaWVsZCkuZXEoYXJyYXlJbmRleCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHhtbE5vZGUgPSAkKHhtbE5vZGUpLmNoaWxkcmVuKGFGaWVsZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh4bWxOb2RlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB4bWxOb2RlID0gJCh4bWxOb2RlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoeG1sTm9kZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmICh4bWxGaWVsZHNbKHhtbEZpZWxkcy5sZW5ndGggLTEpXVswXSA9PSBcIkBcIikge1xuICAgICAgICAgIHZhciB4bWxBdHRyID0geG1sRmllbGRzWyh4bWxGaWVsZHMubGVuZ3RoIC0xKV0uc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIHhtbFZhbHVlID0gJCh4bWxOb2RlKS5hdHRyKHhtbEF0dHIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHhtbFZhbHVlID0gJCh4bWxOb2RlKS50ZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHhtbFZhbHVlO1xuICB9XG59O1xuIl19