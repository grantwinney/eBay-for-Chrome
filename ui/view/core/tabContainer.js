/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var TabContainer = {
    _DEFAULT_TAB: "tab-notification",
    getDefaultTab: function () {
        var defaultTabPref = PropertyDAO.get(PropertyDAO.PROP_DEFAULT_TAB);
        return defaultTabPref || this._DEFAULT_TAB;
    },
    init: function () {
        $("[rel^=i18n],[alt^=i18n]").i18n({ attributeNames: ["alt"] });
        this.setTabAccessLabels();
        $(document).ready(function () {
            if (Configs.BROWSER !== "fx") {
                $("div.tab-notification-container").removeAttr("tabindex");
                $("div.tab-main-container h1").each(function () {
                    $(this).removeAttr("tabindex");
                });
            }
            this._addEventListeners();
            var activeAccount = Account.getAccount();
            if (activeAccount) {
                var symbanData = SymbanService.userData;
                if (symbanData.badgeCount > 0) {
                    this._enforceTabCustomization();
                }
                else {
                    EventAnalytics.push({
                        key: "SignedInInternal",
                        action: "DefaultTabShow",
                        label: Sidebar.getGATabTrackingName(this.getDefaultTab())
                    });
                    this.selectTab(this.getDefaultTab());
                }
            }
        }.bind(this));
        ObserverHelper.addObserver(this, Topics.ACCOUNT_SIGNED_IN);
        ObserverHelper.addObserver(this, Topics.ACCOUNT_SIGNED_OUT);
    },
    uninit: function () {
        ObserverHelper.removeObserver(this, Topics.ACCOUNT_SIGNED_IN);
        ObserverHelper.removeObserver(this, Topics.ACCOUNT_SIGNED_OUT);
    },
    setTabAccessLabels: function () {
        $(".tab-notification-access-label").text($.i18n.getString("tab.access.label", [1, 4]));
        $(".tab-watching-access-label").text($.i18n.getString("tab.access.label", [2, 4]));
        $(".tab-buying-access-label").text($.i18n.getString("tab.access.label", [3, 4]));
        $(".tab-selling-access-label").text($.i18n.getString("tab.access.label", [4, 4]));
    },
    selectTabAccessLabel: function (tabId) {
        var index = 0;
        switch (tabId) {
            case 'tab-notification':
                index = 1;
                break;
            case 'tab-watching':
                index = 2;
                break;
            case 'tab-buying':
                index = 3;
                break;
            case 'tab-selling':
                index = 4;
                break;
        }
        var label = $.i18n.getString("tab.selected.access.label", [index, 4]);
        $("." + tabId + "-access-label").text(label);
    },
    _addEventListeners: function () {
        $(".tab-item").bind("click", function (aEvent) {
            var target = $(aEvent.target);
            var tabId = target.attr("id");
            aEvent.preventDefault();
            if (!tabId) {
                tabId = target.closest(".tab-item").attr("id");
            }
            EventAnalytics.push({
                key: "SignedInInternal",
                action: "ClickTabChange",
                label: Sidebar.getGATabTrackingName(tabId)
            });
            this.selectTab(tabId);
        }.bind(this));
        $("#full-list-button-bar, #full-list-back-button").bind("click", function (aEvent) {
            this.switchFullListView(false);
            var lastSelectedTab = $(".tab-item.active");
            if (lastSelectedTab.attr("id") == "tab-buying") {
                PanelBuying.showFullList(false);
            }
            else {
                PanelSelling.showFullList(false);
            }
        }.bind(this));
    },
    _enforceTabCustomization: function () {
        this.selectTab("tab-notification");
    },
    selectTab: function (aTabId) {
        PropertyDAO.set(PropertyDAO.PROP_DEFAULT_TAB, aTabId);
        var lastSelectedTab = $(".tab-item.active");
        if (lastSelectedTab && lastSelectedTab.attr("id") == "tab-notification") {
            var symbanData = SymbanService.userData;
            if (symbanData.badgeCount > 0) {
                SymbanService.markAllNotificationsAsRead();
            }
        }
        if (aTabId != "tab-watching") {
            PanelWatching.showEditMode(false);
        }
        this.setTabAccessLabels();
        this.selectTabAccessLabel(aTabId);
        $(".tab-item").removeClass("active");
        $("#" + aTabId).addClass("active");
        var panelId = aTabId.replace(/^tab/, "panel") + "-content";
        $(".panel-content").removeClass("active");
        $("#" + panelId).addClass("active");
        if (aTabId == "tab-notification") {
            $("#status-panel").show();
            $("#panels").removeClass("no-status-panel");
            $("#panels").removeClass("show-buttons-container");
        }
        else {
            $("#status-panel").hide();
            $("#panels").addClass("no-status-panel");
            if (aTabId == "tab-watching") {
                PanelContainer.showDockHeaderForWatching();
                if (PanelWatching.isInEditMode) {
                    $("#panels").addClass("show-buttons-container");
                }
                else {
                    $("#panels").removeClass("show-buttons-container");
                }
            }
            else if (aTabId == "tab-buying") {
                $("#panels").removeClass("show-buttons-container");
            }
            else if (aTabId == "tab-selling") {
                $("#panels").addClass("show-buttons-container");
                PanelSelling.updateDraftsButton();
            }
        }
        Sidebar.scrollToTop("panels");
        MessagePanel.onTabChange();
        var elementName = aTabId.substring(aTabId.indexOf("-") + 1, aTabId.length);
        Sidebar.showLoading(elementName);
    },
    switchFullListView: function (aShow) {
        Sidebar.scrollToTop("panels");
        if (aShow) {
            $("#tab-container").hide();
            $("#full-list-button-bar").show();
        }
        else {
            $("#full-list-button-bar").hide();
            $("#tab-container").show();
        }
    },
    setFullListViewTitle: function (aTitle) {
        $("#full-list-title").text(aTitle);
    },
    observe: function (aTopic, aData) {
        switch (aTopic) {
            case Topics.ACCOUNT_SIGNED_IN:
                this.selectTab("tab-notification");
                break;
            case Topics.ACCOUNT_SIGNED_OUT:
                $("#status-panel").show();
                break;
            case Topics.ACCOUNT_SIGNED_OUT:
                $("#status-panel").show();
                break;
        }
    }
};
$(window).unload(function () { TabContainer.uninit(); });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiQ29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdWkvdmlldy9jb3JlL3RhYkNvbnRhaW5lci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUVILElBQUksWUFBWSxHQUFHO0lBRWpCLFlBQVksRUFBRyxrQkFBa0I7SUFFakMsYUFBYSxFQUFHO1FBQ2QsSUFBSSxjQUFjLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNuRSxNQUFNLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQUksRUFBRztRQUVMLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLGNBQWMsRUFBRSxDQUFFLEtBQUssQ0FBRSxFQUFFLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUUxQixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDO1lBR2hCLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDN0IsQ0FBQyxDQUFDLGdDQUFnQyxDQUFDLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUMzRCxDQUFDLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ2xDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ2pDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBQzFCLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN6QyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixJQUFJLFVBQVUsR0FBRyxhQUFh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QyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2YsS0FBSyxNQUFNLENBQUMsaUJBQWlCO2dCQUMzQixJQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ25DLEtBQUssQ0FBQztZQUNSLEtBQUssTUFBTSxDQUFDLGtCQUFrQjtnQkFDNUIsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUMxQixLQUFLLENBQUM7WUFDUixLQUFLLE1BQU0sQ0FBQyxrQkFBa0I7Z0JBQzVCLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDMUIsS0FBSyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUM7Q0FDRixDQUFDO0FBRUYsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFhLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgKEMpIDIwMDctMjAxNSBlQmF5IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqL1xuXG52YXIgVGFiQ29udGFpbmVyID0ge1xuXG4gIF9ERUZBVUxUX1RBQiA6IFwidGFiLW5vdGlmaWNhdGlvblwiLFxuXG4gIGdldERlZmF1bHRUYWIgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGVmYXVsdFRhYlByZWYgPSBQcm9wZXJ0eURBTy5nZXQoUHJvcGVydHlEQU8uUFJPUF9ERUZBVUxUX1RBQik7XG4gICAgcmV0dXJuIGRlZmF1bHRUYWJQcmVmIHx8IHRoaXMuX0RFRkFVTFRfVEFCO1xuICB9LFxuXG4gIGluaXQgOiBmdW5jdGlvbigpIHtcblxuICAgICQoXCJbcmVsXj1pMThuXSxbYWx0Xj1pMThuXVwiKS5pMThuKHsgYXR0cmlidXRlTmFtZXM6IFsgXCJhbHRcIiBdIH0pO1xuICAgIHRoaXMuc2V0VGFiQWNjZXNzTGFiZWxzKCk7XG5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgIC8vIFhYWDogQSBoYWNrIHRvIGF2b2lkIGRvdWJsZSB0YWJiaW5nIGluIENocm9tZSBhbmQgU2FmYXJpLCB3aGljaCB0YWJcbiAgICAgIC8vIHRocm91Z2ggPGE+IGVsZW1lbnRzIGJ5IGRlZmF1bHQuXG4gICAgICBpZiAoQ29uZmlncy5CUk9XU0VSICE9PSBcImZ4XCIpIHtcbiAgICAgICAgJChcImRpdi50YWItbm90aWZpY2F0aW9uLWNvbnRhaW5lclwiKS5yZW1vdmVBdHRyKFwidGFiaW5kZXhcIik7XG4gICAgICAgICQoXCJkaXYudGFiLW1haW4tY29udGFpbmVyIGgxXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwidGFiaW5kZXhcIik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpO1xuICAgICAgdmFyIGFjdGl2ZUFjY291bnQgPSBBY2NvdW50LmdldEFjY291bnQoKTtcbiAgICAgIGlmIChhY3RpdmVBY2NvdW50KSB7XG4gICAgICAgIHZhciBzeW1iYW5EYXRhID0gU3ltYmFuU2VydmljZS51c2VyRGF0YTtcbiAgICAgICAgaWYgKHN5bWJhbkRhdGEuYmFkZ2VDb3VudCA+IDApIHtcbiAgICAgICAgICB0aGlzLl9lbmZvcmNlVGFiQ3VzdG9taXphdGlvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIEV2ZW50QW5hbHl0aWNzLnB1c2goe1xuICAgICAgICAgICAga2V5OiBcIlNpZ25lZEluSW50ZXJuYWxcIixcbiAgICAgICAgICAgIGFjdGlvbjogXCJEZWZhdWx0VGFiU2hvd1wiLFxuICAgICAgICAgICAgbGFiZWw6IFNpZGViYXIuZ2V0R0FUYWJUcmFja2luZ05hbWUodGhpcy5nZXREZWZhdWx0VGFiKCkpXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLnNlbGVjdFRhYih0aGlzLmdldERlZmF1bHRUYWIoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgT2JzZXJ2ZXJIZWxwZXIuYWRkT2JzZXJ2ZXIodGhpcywgVG9waWNzLkFDQ09VTlRfU0lHTkVEX0lOKTtcbiAgICBPYnNlcnZlckhlbHBlci5hZGRPYnNlcnZlcih0aGlzLCBUb3BpY3MuQUNDT1VOVF9TSUdORURfT1VUKTtcbiAgfSxcblxuICB1bmluaXQgOiBmdW5jdGlvbigpIHtcblxuICAgIE9ic2VydmVySGVscGVyLnJlbW92ZU9ic2VydmVyKHRoaXMsIFRvcGljcy5BQ0NPVU5UX1NJR05FRF9JTik7XG4gICAgT2JzZXJ2ZXJIZWxwZXIucmVtb3ZlT2JzZXJ2ZXIodGhpcywgVG9waWNzLkFDQ09VTlRfU0lHTkVEX09VVCk7XG4gIH0sXG5cbiAgc2V0VGFiQWNjZXNzTGFiZWxzOiBmdW5jdGlvbigpIHtcbiAgICAkKFwiLnRhYi1ub3RpZmljYXRpb24tYWNjZXNzLWxhYmVsXCIpLnRleHQoJC5pMThuLmdldFN0cmluZyhcInRhYi5hY2Nlc3MubGFiZWxcIiwgWzEsIDRdKSk7XG4gICAgJChcIi50YWItd2F0Y2hpbmctYWNjZXNzLWxhYmVsXCIpLnRleHQoJC5pMThuLmdldFN0cmluZyhcInRhYi5hY2Nlc3MubGFiZWxcIiwgWzIsIDRdKSk7XG4gICAgJChcIi50YWItYnV5aW5nLWFjY2Vzcy1sYWJlbFwiKS50ZXh0KCQuaTE4bi5nZXRTdHJpbmcoXCJ0YWIuYWNjZXNzLmxhYmVsXCIsIFszLCA0XSkpO1xuICAgICQoXCIudGFiLXNlbGxpbmctYWNjZXNzLWxhYmVsXCIpLnRleHQoJC5pMThuLmdldFN0cmluZyhcInRhYi5hY2Nlc3MubGFiZWxcIiwgWzQsIDRdKSk7XG4gIH0sXG5cbiAgc2VsZWN0VGFiQWNjZXNzTGFiZWw6IGZ1bmN0aW9uKHRhYklkKSB7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICBzd2l0Y2godGFiSWQpIHtcbiAgICAgIGNhc2UgJ3RhYi1ub3RpZmljYXRpb24nOiBpbmRleCA9IDE7IGJyZWFrO1xuICAgICAgY2FzZSAndGFiLXdhdGNoaW5nJzogaW5kZXggPSAyOyBicmVhaztcbiAgICAgIGNhc2UgJ3RhYi1idXlpbmcnOiBpbmRleCA9IDM7IGJyZWFrO1xuICAgICAgY2FzZSAndGFiLXNlbGxpbmcnOiBpbmRleCA9IDQ7IGJyZWFrO1xuICAgIH1cblxuICAgIHZhciBsYWJlbCA9ICQuaTE4bi5nZXRTdHJpbmcoXCJ0YWIuc2VsZWN0ZWQuYWNjZXNzLmxhYmVsXCIsIFtpbmRleCwgNF0pO1xuICAgICQoXCIuXCIgKyB0YWJJZCArIFwiLWFjY2Vzcy1sYWJlbFwiKS50ZXh0KGxhYmVsKTtcbiAgfSxcblxuICBfYWRkRXZlbnRMaXN0ZW5lcnMgOiBmdW5jdGlvbigpIHtcbiAgICAkKFwiLnRhYi1pdGVtXCIpLmJpbmQoXCJjbGlja1wiLCBmdW5jdGlvbihhRXZlbnQpIHtcbiAgICAgIHZhciB0YXJnZXQgPSAkKGFFdmVudC50YXJnZXQpO1xuICAgICAgdmFyIHRhYklkID0gdGFyZ2V0LmF0dHIoXCJpZFwiKTtcbiAgICAgIC8vIFByZXZlbnQgU2FmYXJpIHNlbmRpbmcgcmVxdWVzdHMgb24gdGFiIGNsaWNrLlxuICAgICAgYUV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoIXRhYklkKSB7XG4gICAgICAgIHRhYklkID0gdGFyZ2V0LmNsb3Nlc3QoXCIudGFiLWl0ZW1cIikuYXR0cihcImlkXCIpO1xuICAgICAgfVxuXG4gICAgICBFdmVudEFuYWx5dGljcy5wdXNoKHtcbiAgICAgICAga2V5OiBcIlNpZ25lZEluSW50ZXJuYWxcIixcbiAgICAgICAgYWN0aW9uOiBcIkNsaWNrVGFiQ2hhbmdlXCIsXG4gICAgICAgIGxhYmVsOiBTaWRlYmFyLmdldEdBVGFiVHJhY2tpbmdOYW1lKHRhYklkKVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc2VsZWN0VGFiKHRhYklkKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgJChcIiNmdWxsLWxpc3QtYnV0dG9uLWJhciwgI2Z1bGwtbGlzdC1iYWNrLWJ1dHRvblwiKS5iaW5kKFwiY2xpY2tcIiwgZnVuY3Rpb24oYUV2ZW50KSB7XG4gICAgICB0aGlzLnN3aXRjaEZ1bGxMaXN0VmlldyhmYWxzZSk7XG5cbiAgICAgIHZhciBsYXN0U2VsZWN0ZWRUYWIgPSAkKFwiLnRhYi1pdGVtLmFjdGl2ZVwiKTtcbiAgICAgIGlmIChsYXN0U2VsZWN0ZWRUYWIuYXR0cihcImlkXCIpID09IFwidGFiLWJ1eWluZ1wiKSB7XG4gICAgICAgIFBhbmVsQnV5aW5nLnNob3dGdWxsTGlzdChmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBQYW5lbFNlbGxpbmcuc2hvd0Z1bGxMaXN0KGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuXG4gIF9lbmZvcmNlVGFiQ3VzdG9taXphdGlvbiA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2VsZWN0VGFiKFwidGFiLW5vdGlmaWNhdGlvblwiKTtcbiAgfSxcblxuICBzZWxlY3RUYWIgOiBmdW5jdGlvbihhVGFiSWQpIHtcblxuICAgIFByb3BlcnR5REFPLnNldChQcm9wZXJ0eURBTy5QUk9QX0RFRkFVTFRfVEFCLCBhVGFiSWQpO1xuXG4gICAgLy8gbWFrZSBub3RpZmljYXRpb24gYXMgcmVhZCBpZiBzd2l0Y2hpbmcgZnJvbSB0YWItbm90aWZpY2F0aW9uLlxuICAgIHZhciBsYXN0U2VsZWN0ZWRUYWIgPSAkKFwiLnRhYi1pdGVtLmFjdGl2ZVwiKTtcbiAgICBpZiAobGFzdFNlbGVjdGVkVGFiICYmIGxhc3RTZWxlY3RlZFRhYi5hdHRyKFwiaWRcIikgPT0gXCJ0YWItbm90aWZpY2F0aW9uXCIpIHtcbiAgICAgIHZhciBzeW1iYW5EYXRhID0gU3ltYmFuU2VydmljZS51c2VyRGF0YTtcbiAgICAgIGlmIChzeW1iYW5EYXRhLmJhZGdlQ291bnQgPiAwKSB7XG4gICAgICAgIFN5bWJhblNlcnZpY2UubWFya0FsbE5vdGlmaWNhdGlvbnNBc1JlYWQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYVRhYklkICE9IFwidGFiLXdhdGNoaW5nXCIpIHtcbiAgICAgIFBhbmVsV2F0Y2hpbmcuc2hvd0VkaXRNb2RlKGZhbHNlKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldFRhYkFjY2Vzc0xhYmVscygpO1xuICAgIHRoaXMuc2VsZWN0VGFiQWNjZXNzTGFiZWwoYVRhYklkKTtcblxuICAgICQoXCIudGFiLWl0ZW1cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgJChcIiNcIiArIGFUYWJJZCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICB2YXIgcGFuZWxJZCA9IGFUYWJJZC5yZXBsYWNlKC9edGFiLywgXCJwYW5lbFwiKSArIFwiLWNvbnRlbnRcIjtcbiAgICAkKFwiLnBhbmVsLWNvbnRlbnRcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgJChcIiNcIiArIHBhbmVsSWQpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgaWYgKGFUYWJJZCA9PSBcInRhYi1ub3RpZmljYXRpb25cIikge1xuICAgICAgJChcIiNzdGF0dXMtcGFuZWxcIikuc2hvdygpO1xuICAgICAgJChcIiNwYW5lbHNcIikucmVtb3ZlQ2xhc3MoXCJuby1zdGF0dXMtcGFuZWxcIik7XG4gICAgICAkKFwiI3BhbmVsc1wiKS5yZW1vdmVDbGFzcyhcInNob3ctYnV0dG9ucy1jb250YWluZXJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoXCIjc3RhdHVzLXBhbmVsXCIpLmhpZGUoKTtcbiAgICAgICQoXCIjcGFuZWxzXCIpLmFkZENsYXNzKFwibm8tc3RhdHVzLXBhbmVsXCIpO1xuXG4gICAgICBpZiAoYVRhYklkID09IFwidGFiLXdhdGNoaW5nXCIpIHtcbiAgICAgICAgLy8gZW5zdXJlIHRoZSBkb2NrIGhlYWRlciBpcyBkaXNwbGF5ZWQgYW5kIHRoZSBmbG9hdCBvbmUgaXMgaGlkZGVuXG4gICAgICAgIFBhbmVsQ29udGFpbmVyLnNob3dEb2NrSGVhZGVyRm9yV2F0Y2hpbmcoKTtcbiAgICAgICAgaWYgKFBhbmVsV2F0Y2hpbmcuaXNJbkVkaXRNb2RlKSB7XG4gICAgICAgICAgJChcIiNwYW5lbHNcIikuYWRkQ2xhc3MoXCJzaG93LWJ1dHRvbnMtY29udGFpbmVyXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoXCIjcGFuZWxzXCIpLnJlbW92ZUNsYXNzKFwic2hvdy1idXR0b25zLWNvbnRhaW5lclwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChhVGFiSWQgPT0gXCJ0YWItYnV5aW5nXCIpIHtcbiAgICAgICAgJChcIiNwYW5lbHNcIikucmVtb3ZlQ2xhc3MoXCJzaG93LWJ1dHRvbnMtY29udGFpbmVyXCIpO1xuICAgICAgfSBlbHNlIGlmIChhVGFiSWQgPT0gXCJ0YWItc2VsbGluZ1wiKSB7XG4gICAgICAgICQoXCIjcGFuZWxzXCIpLmFkZENsYXNzKFwic2hvdy1idXR0b25zLWNvbnRhaW5lclwiKTtcbiAgICAgICAgUGFuZWxTZWxsaW5nLnVwZGF0ZURyYWZ0c0J1dHRvbigpO1xuICAgICAgfVxuICAgIH1cbiAgICBTaWRlYmFyLnNjcm9sbFRvVG9wKFwicGFuZWxzXCIpO1xuICAgIE1lc3NhZ2VQYW5lbC5vblRhYkNoYW5nZSgpO1xuXG4gICAgdmFyIGVsZW1lbnROYW1lID0gYVRhYklkLnN1YnN0cmluZyhhVGFiSWQuaW5kZXhPZihcIi1cIikgKyAxLCBhVGFiSWQubGVuZ3RoKTtcbiAgICBTaWRlYmFyLnNob3dMb2FkaW5nKGVsZW1lbnROYW1lKTtcbiAgfSxcblxuICBzd2l0Y2hGdWxsTGlzdFZpZXcgOiBmdW5jdGlvbihhU2hvdykge1xuXG4gICAgU2lkZWJhci5zY3JvbGxUb1RvcChcInBhbmVsc1wiKTtcbiAgICBpZiAoYVNob3cpIHtcbiAgICAgICQoXCIjdGFiLWNvbnRhaW5lclwiKS5oaWRlKCk7XG4gICAgICAkKFwiI2Z1bGwtbGlzdC1idXR0b24tYmFyXCIpLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJChcIiNmdWxsLWxpc3QtYnV0dG9uLWJhclwiKS5oaWRlKCk7XG4gICAgICAkKFwiI3RhYi1jb250YWluZXJcIikuc2hvdygpO1xuICAgIH1cbiAgfSxcblxuICBzZXRGdWxsTGlzdFZpZXdUaXRsZSA6IGZ1bmN0aW9uKGFUaXRsZSkge1xuICAgICQoXCIjZnVsbC1saXN0LXRpdGxlXCIpLnRleHQoYVRpdGxlKTtcbiAgfSxcblxuICBvYnNlcnZlIDogZnVuY3Rpb24oYVRvcGljLCBhRGF0YSkge1xuXG4gICAgc3dpdGNoIChhVG9waWMpIHtcbiAgICAgIGNhc2UgVG9waWNzLkFDQ09VTlRfU0lHTkVEX0lOOlxuICAgICAgICB0aGlzLnNlbGVjdFRhYihcInRhYi1ub3RpZmljYXRpb25cIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUb3BpY3MuQUNDT1VOVF9TSUdORURfT1VUOlxuICAgICAgICAkKFwiI3N0YXR1cy1wYW5lbFwiKS5zaG93KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUb3BpY3MuQUNDT1VOVF9TSUdORURfT1VUOlxuICAgICAgICAkKFwiI3N0YXR1cy1wYW5lbFwiKS5zaG93KCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufTtcblxuJCh3aW5kb3cpLnVubG9hZChmdW5jdGlvbigpIHsgVGFiQ29udGFpbmVyLnVuaW5pdCgpOyB9KTtcbiJdfQ==