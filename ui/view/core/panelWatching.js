/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var PanelWatching = {
    _dataUpdateId: null,
    _isInEditMode: false,
    _isLoadingMore: false,
    _deletedItemIds: [],
    _cachedSelectedDeleteItemIds: [],
    get isInEditMode() {
        return this._isInEditMode;
    },
    init: function () {
        $("[rel^=i18n],[title^=i18n],[alt^=i18n]").i18n({ attributeNames: ["title", "alt"] });
        Sidebar.updateTooltips();
        ObserverHelper.addObserver(this, Topics.ACCOUNT_SIGNED_IN);
        ObserverHelper.addObserver(this, Topics.ACCOUNT_SIGNED_OUT);
        ObserverHelper.addObserver(this, Topics.MY_BUYING_UPDATED);
        ObserverHelper.addObserver(this, Topics.MY_BUYING_WATCH_LIST_UPDATED);
        ObserverHelper.addObserver(this, Topics.MY_BUYING_UPDATING);
        this._addEventListeners();
        if (Account.getAccount()) {
            this._populateData();
            this._startDataUpdate();
        }
    },
    uninit: function () {
        if (this._deletedItemIds.length > 0) {
            this.deleteItems(function () { });
            MyEbayService.removeItemsFromList(TradingApi.WATCH_LIST, this._deletedItemIds);
        }
        ObserverHelper.removeObserver(this, Topics.ACCOUNT_SIGNED_IN);
        ObserverHelper.removeObserver(this, Topics.ACCOUNT_SIGNED_OUT);
        ObserverHelper.removeObserver(this, Topics.MY_BUYING_UPDATED);
        ObserverHelper.removeObserver(this, Topics.MY_BUYING_WATCH_LIST_UPDATED);
        ObserverHelper.removeObserver(this, Topics.MY_BUYING_UPDATING);
    },
    _addEventListeners: function () {
        $("#panel-watching-empty-button").click(function (aEvent) {
            EventAnalytics.push({
                key: "SignedInExit",
                action: "ClickEmptyPanel",
                label: "WatchingEmpty"
            });
            RoverUrlHelper.loadPage("homePage", "emptyListText", null, aEvent);
        }.bind(this));
        $("#item-list-watching-dock-edit, #item-list-watching-float-edit").click(function () {
            EventAnalytics.push({
                key: "SignedInInternal",
                action: "ClickEdit",
                label: "Watching"
            });
            MessagePanel.dismiss(true, true);
            this.showEditMode(true);
        }.bind(this));
        $("#item-list-watching-dock-cancel, #item-list-watching-float-cancel").click(function () {
            EventAnalytics.push({
                key: "SignedInInternal",
                action: "ClickEditCancel",
                label: "Watching"
            });
            this.showEditMode(false);
        }.bind(this));
        $("#panel-watching-delete-button").click(function (aEvent) {
            EventAnalytics.push({
                key: "SignedInInternal",
                action: "ClickEditApply",
                label: "Watching"
            });
            var itemIds = this._getSelectedDeleteItemIds();
            if (itemIds.length > 0) {
                this._hideDeletedItems(itemIds);
                PanelWatching.showEditMode(false);
                MessagePanel.addMessage(MessagePanelService.TYPE.ITEMS_DELETED, { itemType: Item.TYPES.WATCHING, itemNum: itemIds.length });
            }
        }.bind(this)).mousedown(function (aEvent) {
            aEvent.preventDefault();
        });
        $("#item-list-watching-dock-refine, #item-list-watching-float-refine").click(function () {
            EventAnalytics.push({
                key: "SignedInInternal",
                action: "ClickRefine",
                label: "Watching"
            });
            MessagePanel.dismiss(true);
            RefineContainer.show(Item.TYPES.WATCHING);
        }.bind(this));
        $(".item-list-box-dock-header-box *, .item-list-box-float-header-box *").click(function (aEvent) {
            if (aEvent) {
                aEvent.preventDefault();
            }
        }.bind(this));
    },
    _populateData: function (aLoadMore) {
        if (aLoadMore) {
            this._loadMoreUpdate();
        }
        else {
            this._setPanel();
        }
        Sidebar.showLoading("watching");
    },
    _setPanel: function () {
        if (this.apiHasItems()) {
            var watchList = MyEbayService.getList(TradingApi.WATCH_LIST);
            this._createItemBoxes(watchList, "panel-watching");
            $("#panel-watching-empty").css("display", "none");
            $("#panel-watching-main").css("display", "block");
            $("[title^=i18n]").i18n({ attributeNames: ["title"] });
            Sidebar.updateTooltips();
            SymbanService.markAllNotificationsAsRead();
        }
        else {
            if (MyEbayService.isUpdatingBuyingData) {
                $("#panel-watching-empty").css("display", "none");
                $("#panel-watching-main").css("display", "none");
            }
            else {
                $("#panel-watching-main").css("display", "none");
                $("#panel-watching-empty").css("display", "block");
            }
        }
    },
    _createItemBoxes: function (aItems, aId) {
        var container = $("#" + aId);
        var content = $("#" + aId + "-list");
        if (aItems.length > 0) {
            content.empty();
            $.each(aItems, function (aIndex, aItem) {
                content.append(ItemBox.createItemBox(aItem));
            });
            container.show();
            this._setCurrencyNote();
        }
        else {
            container.hide();
            content.empty();
        }
        Sidebar.adjustTabIndex();
        Sidebar.removeTabIndex();
    },
    _setCurrencyNote: function () {
        var note = $("#panel-watching-converted-currency-note");
        if ($("#panel-watching-main").find(".item-price-inner-container.converted").length > 0) {
            note.show();
        }
        else {
            note.hide();
        }
    },
    loadMore: function () {
        if (this._isLoadingMore) {
            return;
        }
        var listName = TradingApi.WATCH_LIST;
        var pageNumber = MyEbayService.getSummary(listName).currentPage + 1;
        this._isLoadingMore = true;
        this._cacheSelectedDeleteItems();
        MyEbayService.loadBuyingListData({
            name: listName,
            entriesPerPage: MyEbayService.LIST_ITEM_BATCH_SIZE,
            pageNumber: pageNumber
        });
        if (!MyEbayService.ignoreRequest[Topics.MY_BUYING_WATCH_LIST_UPDATED]) {
            Sidebar.setElementDisplayed("#panel-watching-lazy-loading", true);
            Sidebar.scrollToBottom("panels");
        }
    },
    _loadMoreUpdate: function () {
        var list = MyEbayService.getList(TradingApi.WATCH_LIST);
        this._createItemBoxes(list, "panel-watching");
        this._applyCachedSelectedDeleteItems();
        Sidebar.setElementDisplayed("#panel-watching-lazy-loading", false);
    },
    showEditMode: function (aShow) {
        if (aShow) {
            this._isInEditMode = true;
            $("#item-list-watching-dock-edit-header, #item-list-watching-float-edit-header").hide();
            $("#item-list-watching-dock-cancel-header, #item-list-watching-float-cancel-header").show();
            $("#panel-watching-buttons-container").show();
            $("#panels").addClass("show-buttons-container");
            $("#panel-watching-list").addClass("edit-mode");
            $("#panel-watching-delete-button").attr("disabled", this.getSelectedDeleteCheckboxes().length === 0);
        }
        else {
            this._isInEditMode = false;
            this._cachedSelectedDeleteItemIds = [];
            $("#item-list-watching-dock-edit-header, #item-list-watching-float-edit-header").show();
            $("#item-list-watching-dock-cancel-header, #item-list-watching-float-cancel-header").hide();
            $("#panel-watching-buttons-container").hide();
            $("#panels").removeClass("show-buttons-container");
            $("#panel-watching-list").removeClass("edit-mode");
        }
    },
    getSelectedDeleteCheckboxes: function () {
        return $("#panel-watching-list").find(".item-edit-checkbox input[type='checkbox']:checked");
    },
    _getSelectedDeleteItemIds: function () {
        var selectedElements = this.getSelectedDeleteCheckboxes();
        var itemIds = [];
        for (var i = 0; i < selectedElements.length; i++) {
            var element = $(selectedElements[i]).parents(".item-box-container").get(0);
            itemIds.push($(element).data("itemObject").get("itemId"));
        }
        return itemIds;
    },
    _cacheSelectedDeleteItems: function () {
        this._cachedSelectedDeleteItemIds = this._getSelectedDeleteItemIds();
    },
    _applyCachedSelectedDeleteItems: function () {
        if (this._cachedSelectedDeleteItemIds.length > 0) {
            var elements = $("#panel-watching-list").find(".item-edit-checkbox input[type='checkbox']");
            for (var i = 0; i < elements.length; i++) {
                var element = $(elements[i]);
                var container = element.parents(".item-box-container").get(0);
                var itemId = $(container).data("itemObject").get("itemId");
                var index = this._cachedSelectedDeleteItemIds.indexOf(itemId);
                if (index > -1) {
                    element.prop("checked", true);
                    this._cachedSelectedDeleteItemIds.splice(index, 1);
                    if (this._cachedSelectedDeleteItemIds.length === 0) {
                        break;
                    }
                }
            }
            this._cachedSelectedDeleteItemIds = [];
        }
    },
    _hideDeletedItems: function (aItemIds) {
        this._deletedItemIds = aItemIds;
        var selectedElements = this.getSelectedDeleteCheckboxes();
        for (var i = 0; i < selectedElements.length; i++) {
            $(selectedElements[i]).parents(".item-box-container").hide();
        }
    },
    _deleteDeletedItems: function () {
        var selectedElements = this.getSelectedDeleteCheckboxes();
        for (var i = 0; i < selectedElements.length; i++) {
            $(selectedElements[i]).parents(".item-box-container").remove();
        }
    },
    showDeletedItems: function () {
        var selectedElements = this.getSelectedDeleteCheckboxes();
        for (var i = 0; i < selectedElements.length; i++) {
            var element = $(selectedElements[i]);
            var container = element.parents(".item-box-container");
            var itemId = container.data("itemObject").get("itemId");
            var index = this._deletedItemIds.indexOf(itemId);
            if (index != -1) {
                element.prop("checked", false);
                container.show();
                this._deletedItemIds.splice(index, 1);
            }
        }
        this._deletedItemIds = [];
    },
    deleteItems: function (aCallback) {
        var that = this;
        var localCallback = function (aResult) {
            if (!aResult.errors) {
                that._deleteDeletedItems();
                MyEbayService.removeItemsFromList(TradingApi.WATCH_LIST, that._deletedItemIds);
                that._deletedItemIds = [];
            }
            else {
                that.showDeletedItems();
                MessagePanelService.addMessage(MessagePanelService.TYPE.CONNECT_ERROR);
            }
        };
        if (this._deletedItemIds.length > 0) {
            var activeAccount = Account.getAccount();
            if (activeAccount) {
                var token = activeAccount.get("token");
                if (token) {
                    var siteId = Site.siteIdForSite(Site.getHomeSite());
                    TradingApi.removeFromWatchList(token, this._deletedItemIds, siteId, (aCallback ? aCallback : localCallback));
                }
            }
        }
    },
    _startDataUpdate: function () {
        this._dataUpdateId = setTimeout(function () {
            this._updateTimeLeft();
            this._startDataUpdate();
        }.bind(this), 1000);
    },
    _stopDataUpdate: function () {
        if (this._dataUpdateId) {
            clearTimeout(this._dataUpdateId);
            delete this._dataUpdateId;
        }
    },
    _updateTimeLeft: function () {
        $("#panel-watching-list").children("a").each(function () {
            ItemBox.updateTimeLeft($(this));
        });
    },
    apiHasItems: function () {
        var apiHasItems = false;
        var watchList = MyEbayService.getList(TradingApi.WATCH_LIST);
        if (watchList.length > 0) {
            apiHasItems = true;
        }
        return apiHasItems;
    },
    observe: function (aTopic, aData) {
        switch (aTopic) {
            case Topics.ACCOUNT_SIGNED_IN:
                this._startDataUpdate();
                break;
            case Topics.ACCOUNT_SIGNED_OUT:
                this._stopDataUpdate();
                this._deletedItemIds = [];
                this._cachedSelectedDeleteItemIds = [];
                break;
            case Topics.MY_BUYING_UPDATED:
                this._isLoadingMore = false;
                this._populateData();
                break;
            case Topics.MY_BUYING_WATCH_LIST_UPDATED:
                this._isLoadingMore = false;
                this._populateData(true);
                break;
            case Topics.MY_BUYING_UPDATING:
                if (!this._isLoadingMore) {
                    Sidebar.showLoading("watching");
                }
                break;
        }
    }
};
$(window).unload(function () { PanelWatching.uninit(); });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWxXYXRjaGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3VpL3ZpZXcvY29yZS9wYW5lbFdhdGNoaW5nLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBRUgsSUFBSSxhQUFhLEdBQUc7SUFDbEIsYUFBYSxFQUFHLElBQUk7SUFDcEIsYUFBYSxFQUFFLEtBQUs7SUFDcEIsY0FBYyxFQUFFLEtBQUs7SUFDckIsZUFBZSxFQUFFLEVBQUU7SUFDbkIsNEJBQTRCLEVBQUUsRUFBRTtJQUVoQyxJQUFJLFlBQVk7UUFDZCxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBRUQsSUFBSSxFQUFFO1FBQ0osQ0FBQyxDQUFDLHVDQUF1QyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsY0FBYyxFQUFFLENBQUUsT0FBTyxFQUFFLEtBQUssQ0FBRSxFQUFFLENBQUMsQ0FBQztRQUN4RixPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFekIsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDM0QsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDNUQsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDM0QsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFDdEUsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFNUQsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDMUIsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsYUFB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IEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKi9cblxudmFyIFBhbmVsV2F0Y2hpbmcgPSB7XG4gIF9kYXRhVXBkYXRlSWQgOiBudWxsLFxuICBfaXNJbkVkaXRNb2RlOiBmYWxzZSxcbiAgX2lzTG9hZGluZ01vcmU6IGZhbHNlLFxuICBfZGVsZXRlZEl0ZW1JZHM6IFtdLFxuICBfY2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtSWRzOiBbXSxcblxuICBnZXQgaXNJbkVkaXRNb2RlKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0luRWRpdE1vZGU7XG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgJChcIltyZWxePWkxOG5dLFt0aXRsZV49aTE4bl0sW2FsdF49aTE4bl1cIikuaTE4bih7IGF0dHJpYnV0ZU5hbWVzOiBbIFwidGl0bGVcIiwgXCJhbHRcIiBdIH0pO1xuICAgIFNpZGViYXIudXBkYXRlVG9vbHRpcHMoKTtcblxuICAgIE9ic2VydmVySGVscGVyLmFkZE9ic2VydmVyKHRoaXMsIFRvcGljcy5BQ0NPVU5UX1NJR05FRF9JTik7XG4gICAgT2JzZXJ2ZXJIZWxwZXIuYWRkT2JzZXJ2ZXIodGhpcywgVG9waWNzLkFDQ09VTlRfU0lHTkVEX09VVCk7XG4gICAgT2JzZXJ2ZXJIZWxwZXIuYWRkT2JzZXJ2ZXIodGhpcywgVG9waWNzLk1ZX0JVWUlOR19VUERBVEVEKTtcbiAgICBPYnNlcnZlckhlbHBlci5hZGRPYnNlcnZlcih0aGlzLCBUb3BpY3MuTVlfQlVZSU5HX1dBVENIX0xJU1RfVVBEQVRFRCk7XG4gICAgT2JzZXJ2ZXJIZWxwZXIuYWRkT2JzZXJ2ZXIodGhpcywgVG9waWNzLk1ZX0JVWUlOR19VUERBVElORyk7XG5cbiAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpO1xuICAgIGlmIChBY2NvdW50LmdldEFjY291bnQoKSkge1xuICAgICAgdGhpcy5fcG9wdWxhdGVEYXRhKCk7XG4gICAgICB0aGlzLl9zdGFydERhdGFVcGRhdGUoKTtcbiAgICB9XG4gIH0sXG5cbiAgdW5pbml0IDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2RlbGV0ZWRJdGVtSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZGVsZXRlSXRlbXMoZnVuY3Rpb24oKSB7fSk7XG4gICAgICBNeUViYXlTZXJ2aWNlLnJlbW92ZUl0ZW1zRnJvbUxpc3QoXG4gICAgICAgIFRyYWRpbmdBcGkuV0FUQ0hfTElTVCwgdGhpcy5fZGVsZXRlZEl0ZW1JZHMpO1xuICAgIH1cbiAgICBPYnNlcnZlckhlbHBlci5yZW1vdmVPYnNlcnZlcih0aGlzLCBUb3BpY3MuQUNDT1VOVF9TSUdORURfSU4pO1xuICAgIE9ic2VydmVySGVscGVyLnJlbW92ZU9ic2VydmVyKHRoaXMsIFRvcGljcy5BQ0NPVU5UX1NJR05FRF9PVVQpO1xuICAgIE9ic2VydmVySGVscGVyLnJlbW92ZU9ic2VydmVyKHRoaXMsIFRvcGljcy5NWV9CVVlJTkdfVVBEQVRFRCk7XG4gICAgT2JzZXJ2ZXJIZWxwZXIucmVtb3ZlT2JzZXJ2ZXIodGhpcywgVG9waWNzLk1ZX0JVWUlOR19XQVRDSF9MSVNUX1VQREFURUQpO1xuICAgIE9ic2VydmVySGVscGVyLnJlbW92ZU9ic2VydmVyKHRoaXMsIFRvcGljcy5NWV9CVVlJTkdfVVBEQVRJTkcpO1xuICB9LFxuXG4gIF9hZGRFdmVudExpc3RlbmVycyA6IGZ1bmN0aW9uKCkge1xuICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctZW1wdHktYnV0dG9uXCIpLmNsaWNrKGZ1bmN0aW9uKGFFdmVudCkge1xuICAgICAgRXZlbnRBbmFseXRpY3MucHVzaCh7XG4gICAgICAgIGtleTogXCJTaWduZWRJbkV4aXRcIixcbiAgICAgICAgYWN0aW9uOiBcIkNsaWNrRW1wdHlQYW5lbFwiLFxuICAgICAgICBsYWJlbDogXCJXYXRjaGluZ0VtcHR5XCJcbiAgICAgIH0pO1xuICAgICAgUm92ZXJVcmxIZWxwZXIubG9hZFBhZ2UoXCJob21lUGFnZVwiLCBcImVtcHR5TGlzdFRleHRcIiwgbnVsbCwgYUV2ZW50KTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgJChcIiNpdGVtLWxpc3Qtd2F0Y2hpbmctZG9jay1lZGl0LCAjaXRlbS1saXN0LXdhdGNoaW5nLWZsb2F0LWVkaXRcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBFdmVudEFuYWx5dGljcy5wdXNoKHtcbiAgICAgICAga2V5OiBcIlNpZ25lZEluSW50ZXJuYWxcIixcbiAgICAgICAgYWN0aW9uOiBcIkNsaWNrRWRpdFwiLFxuICAgICAgICBsYWJlbDogXCJXYXRjaGluZ1wiXG4gICAgICB9KTtcbiAgICAgIE1lc3NhZ2VQYW5lbC5kaXNtaXNzKHRydWUsIHRydWUpO1xuICAgICAgdGhpcy5zaG93RWRpdE1vZGUodHJ1ZSk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgICAkKFwiI2l0ZW0tbGlzdC13YXRjaGluZy1kb2NrLWNhbmNlbCwgI2l0ZW0tbGlzdC13YXRjaGluZy1mbG9hdC1jYW5jZWxcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBFdmVudEFuYWx5dGljcy5wdXNoKHtcbiAgICAgICAga2V5OiBcIlNpZ25lZEluSW50ZXJuYWxcIixcbiAgICAgICAgYWN0aW9uOiBcIkNsaWNrRWRpdENhbmNlbFwiLFxuICAgICAgICBsYWJlbDogXCJXYXRjaGluZ1wiXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2hvd0VkaXRNb2RlKGZhbHNlKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgJChcIiNwYW5lbC13YXRjaGluZy1kZWxldGUtYnV0dG9uXCIpLmNsaWNrKGZ1bmN0aW9uKGFFdmVudCkge1xuICAgICAgRXZlbnRBbmFseXRpY3MucHVzaCh7XG4gICAgICAgIGtleTogXCJTaWduZWRJbkludGVybmFsXCIsXG4gICAgICAgIGFjdGlvbjogXCJDbGlja0VkaXRBcHBseVwiLFxuICAgICAgICBsYWJlbDogXCJXYXRjaGluZ1wiXG4gICAgICB9KTtcbiAgICAgIHZhciBpdGVtSWRzID0gdGhpcy5fZ2V0U2VsZWN0ZWREZWxldGVJdGVtSWRzKCk7XG4gICAgICBpZiAoaXRlbUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuX2hpZGVEZWxldGVkSXRlbXMoaXRlbUlkcyk7XG4gICAgICAgIFBhbmVsV2F0Y2hpbmcuc2hvd0VkaXRNb2RlKGZhbHNlKTtcbiAgICAgICAgTWVzc2FnZVBhbmVsLmFkZE1lc3NhZ2UoXG4gICAgICAgICAgTWVzc2FnZVBhbmVsU2VydmljZS5UWVBFLklURU1TX0RFTEVURUQsXG4gICAgICAgICAgeyBpdGVtVHlwZTogSXRlbS5UWVBFUy5XQVRDSElORywgaXRlbU51bTogaXRlbUlkcy5sZW5ndGggfSk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKS5tb3VzZWRvd24oZnVuY3Rpb24oYUV2ZW50KSB7XG4gICAgICBhRXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgICQoXCIjaXRlbS1saXN0LXdhdGNoaW5nLWRvY2stcmVmaW5lLCAjaXRlbS1saXN0LXdhdGNoaW5nLWZsb2F0LXJlZmluZVwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgIEV2ZW50QW5hbHl0aWNzLnB1c2goe1xuICAgICAgICBrZXk6IFwiU2lnbmVkSW5JbnRlcm5hbFwiLFxuICAgICAgICBhY3Rpb246IFwiQ2xpY2tSZWZpbmVcIixcbiAgICAgICAgbGFiZWw6IFwiV2F0Y2hpbmdcIlxuICAgICAgfSk7XG4gICAgICAvLyBjcmVhdGUgdGhlIHVuZG8gZGlhbG9nXG4gICAgICBNZXNzYWdlUGFuZWwuZGlzbWlzcyh0cnVlKTtcbiAgICAgIFJlZmluZUNvbnRhaW5lci5zaG93KEl0ZW0uVFlQRVMuV0FUQ0hJTkcpO1xuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAkKFwiLml0ZW0tbGlzdC1ib3gtZG9jay1oZWFkZXItYm94ICosIC5pdGVtLWxpc3QtYm94LWZsb2F0LWhlYWRlci1ib3ggKlwiKS5jbGljayhmdW5jdGlvbihhRXZlbnQpIHtcbiAgICAgIGlmIChhRXZlbnQpIHtcbiAgICAgICAgLy8gUHJldmVudCBTYWZhcmkgc2VuZGluZyBkZWZhdWx0IHJlcXVlc3RzIG9uIGl0ZW0gY2xpY2suXG4gICAgICAgIGFFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG4gIH0sXG5cbiAgX3BvcHVsYXRlRGF0YSA6IGZ1bmN0aW9uKGFMb2FkTW9yZSkge1xuICAgIGlmIChhTG9hZE1vcmUpIHtcbiAgICAgIHRoaXMuX2xvYWRNb3JlVXBkYXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldFBhbmVsKCk7XG4gICAgfVxuICAgIFNpZGViYXIuc2hvd0xvYWRpbmcoXCJ3YXRjaGluZ1wiKTtcbiAgfSxcblxuICBfc2V0UGFuZWwgOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5hcGlIYXNJdGVtcygpKSB7XG4gICAgICB2YXIgd2F0Y2hMaXN0ID1cbiAgICAgICAgTXlFYmF5U2VydmljZS5nZXRMaXN0KFRyYWRpbmdBcGkuV0FUQ0hfTElTVCk7XG5cbiAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1Cb3hlcyh3YXRjaExpc3QsIFwicGFuZWwtd2F0Y2hpbmdcIik7XG4gICAgICAvL2ZvciBzb21lIHN0cmFuZ2UgcmVhc29uLCB1c2luZyAuaGlkZSgpIGhlcmUgd2lsbCB0aHJvdyBhbiBlcnJvcjpcbiAgICAgIC8vQ2Fubm90IHJlYWQgcHJvcGVydHkgJ2dldENvbXB1dGVkU3R5bGUnIG9mIHVuZGVmaW5lZFxuICAgICAgJChcIiNwYW5lbC13YXRjaGluZy1lbXB0eVwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgIC8vZm9yIHNvbWUgc3RyYW5nZSByZWFzb24sIHVzaW5nIC5zaG93KCkgaGVyZSB3aWxsIHRocm93IGFuIGVycm9yOlxuICAgICAgLy9DYW5ub3QgcmVhZCBwcm9wZXJ0eSAnZ2V0Q29tcHV0ZWRTdHlsZScgb2YgdW5kZWZpbmVkXG4gICAgICAkKFwiI3BhbmVsLXdhdGNoaW5nLW1haW5cIikuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xuICAgICAgLy8gYXBwbHkgdHJhbnNsYXRpb25zIGFnYWluXG4gICAgICAkKFwiW3RpdGxlXj1pMThuXVwiKS5pMThuKHsgYXR0cmlidXRlTmFtZXM6IFsgXCJ0aXRsZVwiIF0gfSk7XG4gICAgICBTaWRlYmFyLnVwZGF0ZVRvb2x0aXBzKCk7XG4gICAgICAvL21hcmsgYWxsIG5vdGlmaWNhdGlvbnMgYXMgcmVhZCBhZnRlciB0aGUgcGFnZSBoYXMgbG9hZGVkLlxuICAgICAgU3ltYmFuU2VydmljZS5tYXJrQWxsTm90aWZpY2F0aW9uc0FzUmVhZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoTXlFYmF5U2VydmljZS5pc1VwZGF0aW5nQnV5aW5nRGF0YSkge1xuICAgICAgICAkKFwiI3BhbmVsLXdhdGNoaW5nLWVtcHR5XCIpLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgICAkKFwiI3BhbmVsLXdhdGNoaW5nLW1haW5cIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI3BhbmVsLXdhdGNoaW5nLW1haW5cIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctZW1wdHlcIikuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfY3JlYXRlSXRlbUJveGVzIDogZnVuY3Rpb24oYUl0ZW1zLCBhSWQpIHtcbiAgICB2YXIgY29udGFpbmVyID0gJChcIiNcIiArIGFJZCk7XG4gICAgdmFyIGNvbnRlbnQgPSAkKFwiI1wiICsgYUlkICsgXCItbGlzdFwiKTtcblxuICAgIGlmIChhSXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgY29udGVudC5lbXB0eSgpO1xuICAgICAgJC5lYWNoKGFJdGVtcywgZnVuY3Rpb24oYUluZGV4LCBhSXRlbSkge1xuICAgICAgICBjb250ZW50LmFwcGVuZChJdGVtQm94LmNyZWF0ZUl0ZW1Cb3goYUl0ZW0pKTtcbiAgICAgIH0pO1xuICAgICAgY29udGFpbmVyLnNob3coKTtcbiAgICAgIHRoaXMuX3NldEN1cnJlbmN5Tm90ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250YWluZXIuaGlkZSgpO1xuICAgICAgY29udGVudC5lbXB0eSgpO1xuICAgIH1cbiAgICBTaWRlYmFyLmFkanVzdFRhYkluZGV4KCk7XG4gICAgU2lkZWJhci5yZW1vdmVUYWJJbmRleCgpO1xuICB9LFxuXG4gIF9zZXRDdXJyZW5jeU5vdGUgOiBmdW5jdGlvbigpIHtcbiAgICAvLyBzaG93IGN1cnJlbmN5IG5vdGVcbiAgICB2YXIgbm90ZSA9ICQoXCIjcGFuZWwtd2F0Y2hpbmctY29udmVydGVkLWN1cnJlbmN5LW5vdGVcIik7XG4gICAgaWYgKCQoXCIjcGFuZWwtd2F0Y2hpbmctbWFpblwiKS5maW5kKFwiLml0ZW0tcHJpY2UtaW5uZXItY29udGFpbmVyLmNvbnZlcnRlZFwiKS5sZW5ndGggPiAwKSB7XG4gICAgICBub3RlLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm90ZS5oaWRlKCk7XG4gICAgfVxuICB9LFxuXG4gIGxvYWRNb3JlIDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzTG9hZGluZ01vcmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbGlzdE5hbWUgPSBUcmFkaW5nQXBpLldBVENIX0xJU1Q7XG4gICAgdmFyIHBhZ2VOdW1iZXIgPSBNeUViYXlTZXJ2aWNlLmdldFN1bW1hcnkobGlzdE5hbWUpLmN1cnJlbnRQYWdlICsgMTtcblxuICAgIHRoaXMuX2lzTG9hZGluZ01vcmUgPSB0cnVlO1xuICAgIHRoaXMuX2NhY2hlU2VsZWN0ZWREZWxldGVJdGVtcygpO1xuICAgIE15RWJheVNlcnZpY2UubG9hZEJ1eWluZ0xpc3REYXRhKHtcbiAgICAgIG5hbWU6IGxpc3ROYW1lLFxuICAgICAgZW50cmllc1BlclBhZ2U6IE15RWJheVNlcnZpY2UuTElTVF9JVEVNX0JBVENIX1NJWkUsXG4gICAgICBwYWdlTnVtYmVyOiBwYWdlTnVtYmVyXG4gICAgfSk7XG5cbiAgICBpZiAoIU15RWJheVNlcnZpY2UuaWdub3JlUmVxdWVzdFtUb3BpY3MuTVlfQlVZSU5HX1dBVENIX0xJU1RfVVBEQVRFRF0pIHtcbiAgICAgIFNpZGViYXIuc2V0RWxlbWVudERpc3BsYXllZChcIiNwYW5lbC13YXRjaGluZy1sYXp5LWxvYWRpbmdcIiwgdHJ1ZSk7XG4gICAgICBTaWRlYmFyLnNjcm9sbFRvQm90dG9tKFwicGFuZWxzXCIpO1xuICAgIH1cbiAgfSxcblxuICBfbG9hZE1vcmVVcGRhdGUgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbGlzdCA9IE15RWJheVNlcnZpY2UuZ2V0TGlzdChUcmFkaW5nQXBpLldBVENIX0xJU1QpO1xuICAgIHRoaXMuX2NyZWF0ZUl0ZW1Cb3hlcyhsaXN0LCBcInBhbmVsLXdhdGNoaW5nXCIpO1xuICAgIHRoaXMuX2FwcGx5Q2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtcygpO1xuXG4gICAgU2lkZWJhci5zZXRFbGVtZW50RGlzcGxheWVkKFwiI3BhbmVsLXdhdGNoaW5nLWxhenktbG9hZGluZ1wiLCBmYWxzZSk7XG4gIH0sXG5cbiAgc2hvd0VkaXRNb2RlIDogZnVuY3Rpb24oYVNob3cpIHtcbiAgICBpZiAoYVNob3cpIHtcbiAgICAgIHRoaXMuX2lzSW5FZGl0TW9kZSA9IHRydWU7XG4gICAgICAkKFwiI2l0ZW0tbGlzdC13YXRjaGluZy1kb2NrLWVkaXQtaGVhZGVyLCAjaXRlbS1saXN0LXdhdGNoaW5nLWZsb2F0LWVkaXQtaGVhZGVyXCIpLmhpZGUoKTtcbiAgICAgICQoXCIjaXRlbS1saXN0LXdhdGNoaW5nLWRvY2stY2FuY2VsLWhlYWRlciwgI2l0ZW0tbGlzdC13YXRjaGluZy1mbG9hdC1jYW5jZWwtaGVhZGVyXCIpLnNob3coKTtcbiAgICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctYnV0dG9ucy1jb250YWluZXJcIikuc2hvdygpO1xuICAgICAgJChcIiNwYW5lbHNcIikuYWRkQ2xhc3MoXCJzaG93LWJ1dHRvbnMtY29udGFpbmVyXCIpO1xuICAgICAgJChcIiNwYW5lbC13YXRjaGluZy1saXN0XCIpLmFkZENsYXNzKFwiZWRpdC1tb2RlXCIpO1xuICAgICAgJChcIiNwYW5lbC13YXRjaGluZy1kZWxldGUtYnV0dG9uXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCB0aGlzLmdldFNlbGVjdGVkRGVsZXRlQ2hlY2tib3hlcygpLmxlbmd0aCA9PT0gMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2lzSW5FZGl0TW9kZSA9IGZhbHNlO1xuICAgICAgdGhpcy5fY2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtSWRzID0gW107XG4gICAgICAkKFwiI2l0ZW0tbGlzdC13YXRjaGluZy1kb2NrLWVkaXQtaGVhZGVyLCAjaXRlbS1saXN0LXdhdGNoaW5nLWZsb2F0LWVkaXQtaGVhZGVyXCIpLnNob3coKTtcbiAgICAgICQoXCIjaXRlbS1saXN0LXdhdGNoaW5nLWRvY2stY2FuY2VsLWhlYWRlciwgI2l0ZW0tbGlzdC13YXRjaGluZy1mbG9hdC1jYW5jZWwtaGVhZGVyXCIpLmhpZGUoKTtcbiAgICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctYnV0dG9ucy1jb250YWluZXJcIikuaGlkZSgpO1xuICAgICAgJChcIiNwYW5lbHNcIikucmVtb3ZlQ2xhc3MoXCJzaG93LWJ1dHRvbnMtY29udGFpbmVyXCIpO1xuICAgICAgJChcIiNwYW5lbC13YXRjaGluZy1saXN0XCIpLnJlbW92ZUNsYXNzKFwiZWRpdC1tb2RlXCIpO1xuICAgIH1cbiAgfSxcblxuICBnZXRTZWxlY3RlZERlbGV0ZUNoZWNrYm94ZXMgOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJChcIiNwYW5lbC13YXRjaGluZy1saXN0XCIpLmZpbmQoXCIuaXRlbS1lZGl0LWNoZWNrYm94IGlucHV0W3R5cGU9J2NoZWNrYm94J106Y2hlY2tlZFwiKTtcbiAgfSxcblxuICBfZ2V0U2VsZWN0ZWREZWxldGVJdGVtSWRzIDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdGVkRWxlbWVudHMgPSB0aGlzLmdldFNlbGVjdGVkRGVsZXRlQ2hlY2tib3hlcygpO1xuICAgIHZhciBpdGVtSWRzID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGVkRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBlbGVtZW50ID0gJChzZWxlY3RlZEVsZW1lbnRzW2ldKS5wYXJlbnRzKFwiLml0ZW0tYm94LWNvbnRhaW5lclwiKS5nZXQoMCk7XG4gICAgICBpdGVtSWRzLnB1c2goJChlbGVtZW50KS5kYXRhKFwiaXRlbU9iamVjdFwiKS5nZXQoXCJpdGVtSWRcIikpO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUlkcztcbiAgfSxcblxuICBfY2FjaGVTZWxlY3RlZERlbGV0ZUl0ZW1zIDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fY2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtSWRzID0gdGhpcy5fZ2V0U2VsZWN0ZWREZWxldGVJdGVtSWRzKCk7XG4gIH0sXG5cbiAgX2FwcGx5Q2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtcyA6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9jYWNoZWRTZWxlY3RlZERlbGV0ZUl0ZW1JZHMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIGVsZW1lbnRzID0gJChcIiNwYW5lbC13YXRjaGluZy1saXN0XCIpLmZpbmQoXCIuaXRlbS1lZGl0LWNoZWNrYm94IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIik7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGVsZW1lbnRzW2ldKTtcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQucGFyZW50cyhcIi5pdGVtLWJveC1jb250YWluZXJcIikuZ2V0KDApO1xuICAgICAgICB2YXIgaXRlbUlkID0gJChjb250YWluZXIpLmRhdGEoXCJpdGVtT2JqZWN0XCIpLmdldChcIml0ZW1JZFwiKTtcblxuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9jYWNoZWRTZWxlY3RlZERlbGV0ZUl0ZW1JZHMuaW5kZXhPZihpdGVtSWQpO1xuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgIGVsZW1lbnQucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgdGhpcy5fY2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtSWRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgaWYgKHRoaXMuX2NhY2hlZFNlbGVjdGVkRGVsZXRlSXRlbUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fY2FjaGVkU2VsZWN0ZWREZWxldGVJdGVtSWRzID0gW107XG4gICAgfVxuICB9LFxuXG4gIF9oaWRlRGVsZXRlZEl0ZW1zIDogZnVuY3Rpb24oYUl0ZW1JZHMpIHtcbiAgICB0aGlzLl9kZWxldGVkSXRlbUlkcyA9IGFJdGVtSWRzO1xuXG4gICAgdmFyIHNlbGVjdGVkRWxlbWVudHMgPSB0aGlzLmdldFNlbGVjdGVkRGVsZXRlQ2hlY2tib3hlcygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgJChzZWxlY3RlZEVsZW1lbnRzW2ldKS5wYXJlbnRzKFwiLml0ZW0tYm94LWNvbnRhaW5lclwiKS5oaWRlKCk7XG4gICAgfVxuICB9LFxuXG4gIF9kZWxldGVEZWxldGVkSXRlbXMgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZWN0ZWRFbGVtZW50cyA9IHRoaXMuZ2V0U2VsZWN0ZWREZWxldGVDaGVja2JveGVzKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RlZEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAkKHNlbGVjdGVkRWxlbWVudHNbaV0pLnBhcmVudHMoXCIuaXRlbS1ib3gtY29udGFpbmVyXCIpLnJlbW92ZSgpO1xuICAgIH1cbiAgfSxcblxuICBzaG93RGVsZXRlZEl0ZW1zIDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdGVkRWxlbWVudHMgPSB0aGlzLmdldFNlbGVjdGVkRGVsZXRlQ2hlY2tib3hlcygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGVsZW1lbnQgPSAkKHNlbGVjdGVkRWxlbWVudHNbaV0pO1xuICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQucGFyZW50cyhcIi5pdGVtLWJveC1jb250YWluZXJcIik7XG4gICAgICB2YXIgaXRlbUlkID0gY29udGFpbmVyLmRhdGEoXCJpdGVtT2JqZWN0XCIpLmdldChcIml0ZW1JZFwiKTtcbiAgICAgIHZhciBpbmRleCA9IHRoaXMuX2RlbGV0ZWRJdGVtSWRzLmluZGV4T2YoaXRlbUlkKTtcbiAgICAgIGlmIChpbmRleCAhPSAtMSkge1xuICAgICAgICBlbGVtZW50LnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKTtcbiAgICAgICAgY29udGFpbmVyLnNob3coKTtcbiAgICAgICAgdGhpcy5fZGVsZXRlZEl0ZW1JZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fZGVsZXRlZEl0ZW1JZHMgPSBbXTtcbiAgfSxcblxuICBkZWxldGVJdGVtcyA6IGZ1bmN0aW9uKGFDYWxsYmFjaykge1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICB2YXIgbG9jYWxDYWxsYmFjayA9IGZ1bmN0aW9uKGFSZXN1bHQpIHtcbiAgICAgIGlmICghYVJlc3VsdC5lcnJvcnMpIHtcbiAgICAgICAgLy8gcmVtb3ZlIGl0ZW0gZnJvbSB0aGUgbGlzdFxuICAgICAgICB0aGF0Ll9kZWxldGVEZWxldGVkSXRlbXMoKTtcbiAgICAgICAgTXlFYmF5U2VydmljZS5yZW1vdmVJdGVtc0Zyb21MaXN0KFxuICAgICAgICAgIFRyYWRpbmdBcGkuV0FUQ0hfTElTVCwgdGhhdC5fZGVsZXRlZEl0ZW1JZHMpO1xuICAgICAgICB0aGF0Ll9kZWxldGVkSXRlbUlkcyA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhhdC5zaG93RGVsZXRlZEl0ZW1zKCk7XG4gICAgICAgIE1lc3NhZ2VQYW5lbFNlcnZpY2UuYWRkTWVzc2FnZShcbiAgICAgICAgICBNZXNzYWdlUGFuZWxTZXJ2aWNlLlRZUEUuQ09OTkVDVF9FUlJPUik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmICh0aGlzLl9kZWxldGVkSXRlbUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgYWN0aXZlQWNjb3VudCA9IEFjY291bnQuZ2V0QWNjb3VudCgpO1xuICAgICAgaWYgKGFjdGl2ZUFjY291bnQpIHtcbiAgICAgICAgdmFyIHRva2VuID0gYWN0aXZlQWNjb3VudC5nZXQoXCJ0b2tlblwiKTtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgdmFyIHNpdGVJZCA9IFNpdGUuc2l0ZUlkRm9yU2l0ZShcbiAgICAgICAgICAgIFNpdGUuZ2V0SG9tZVNpdGUoKSk7XG4gICAgICAgICAgVHJhZGluZ0FwaS5yZW1vdmVGcm9tV2F0Y2hMaXN0KFxuICAgICAgICAgICAgdG9rZW4sIHRoaXMuX2RlbGV0ZWRJdGVtSWRzLCBzaXRlSWQsIChhQ2FsbGJhY2sgPyBhQ2FsbGJhY2sgOiBsb2NhbENhbGxiYWNrKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX3N0YXJ0RGF0YVVwZGF0ZSA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2RhdGFVcGRhdGVJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl91cGRhdGVUaW1lTGVmdCgpO1xuICAgICAgdGhpcy5fc3RhcnREYXRhVXBkYXRlKCk7XG4gICAgfS5iaW5kKHRoaXMpLCAxMDAwKTtcbiAgfSxcblxuICBfc3RvcERhdGFVcGRhdGUgOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fZGF0YVVwZGF0ZUlkKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5fZGF0YVVwZGF0ZUlkKTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9kYXRhVXBkYXRlSWQ7XG4gICAgfVxuICB9LFxuXG4gIF91cGRhdGVUaW1lTGVmdCA6IGZ1bmN0aW9uKCkge1xuICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctbGlzdFwiKS5jaGlsZHJlbihcImFcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIEl0ZW1Cb3gudXBkYXRlVGltZUxlZnQoJCh0aGlzKSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgYXBpSGFzSXRlbXMgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXBpSGFzSXRlbXMgPSBmYWxzZTtcbiAgICB2YXIgd2F0Y2hMaXN0ID1cbiAgICAgIE15RWJheVNlcnZpY2UuZ2V0TGlzdChUcmFkaW5nQXBpLldBVENIX0xJU1QpO1xuXG4gICAgaWYgKHdhdGNoTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICBhcGlIYXNJdGVtcyA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFwaUhhc0l0ZW1zO1xuICB9LFxuXG4gIG9ic2VydmUgOiBmdW5jdGlvbihhVG9waWMsIGFEYXRhKSB7XG4gICAgc3dpdGNoIChhVG9waWMpIHtcbiAgICAgIGNhc2UgVG9waWNzLkFDQ09VTlRfU0lHTkVEX0lOOlxuICAgICAgICB0aGlzLl9zdGFydERhdGFVcGRhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFRvcGljcy5BQ0NPVU5UX1NJR05FRF9PVVQ6XG4gICAgICAgIHRoaXMuX3N0b3BEYXRhVXBkYXRlKCk7XG4gICAgICAgIHRoaXMuX2RlbGV0ZWRJdGVtSWRzID0gW107XG4gICAgICAgIHRoaXMuX2NhY2hlZFNlbGVjdGVkRGVsZXRlSXRlbUlkcyA9IFtdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVG9waWNzLk1ZX0JVWUlOR19VUERBVEVEOlxuICAgICAgICB0aGlzLl9pc0xvYWRpbmdNb3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3BvcHVsYXRlRGF0YSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVG9waWNzLk1ZX0JVWUlOR19XQVRDSF9MSVNUX1VQREFURUQ6XG4gICAgICAgIHRoaXMuX2lzTG9hZGluZ01vcmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fcG9wdWxhdGVEYXRhKHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVG9waWNzLk1ZX0JVWUlOR19VUERBVElORzpcbiAgICAgICAgaWYgKCF0aGlzLl9pc0xvYWRpbmdNb3JlKSB7XG4gICAgICAgICAgU2lkZWJhci5zaG93TG9hZGluZyhcIndhdGNoaW5nXCIpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufTtcblxuJCh3aW5kb3cpLnVubG9hZChmdW5jdGlvbigpIHsgUGFuZWxXYXRjaGluZy51bmluaXQoKTsgfSk7XG4iXX0=