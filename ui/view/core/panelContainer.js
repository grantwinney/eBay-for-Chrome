/*!
 * Copyright (C) 2007-2015 eBay Inc. All Rights Reserved.
 */
var PanelContainer = {
    init: function () {
        var that = this;
        $("[rel^=i18n]").i18n();
        this._loadInnerPages();
        Sidebar.styleScroll("panels", function () {
            $("#status-panel").addClass("has-scroll");
        }, function () {
            $("#status-panel").removeClass("has-scroll");
        }, function () {
            that._updateDockHeader(this);
        }, function () {
            switch ($(".tab-item.active").attr("id")) {
                case "tab-watching":
                    PanelWatching.loadMore();
                    break;
                case "tab-buying":
                    if ($("#panel-buying-main-full-list").is(':visible')) {
                        PanelBuying.loadMoreToFullList();
                    }
                    break;
                case "tab-selling":
                    if ($("#panel-selling-main-full-list").is(':visible')) {
                        PanelSelling.loadMoreToFullList();
                    }
                    break;
            }
        }, function () {
            that._scrollFrom = -1;
            that._updateDockHeader(this);
        });
    },
    uninit: function () {
    },
    resetDockHeader: function () {
        var lastSelectedTabId = $(".tab-item.active").attr("id");
        var dockHeaderBox;
        var floatHeaderBox;
        if (lastSelectedTabId == "tab-buying") {
            if ($("#panel-buying-main-full-list").is(':visible') &&
                PanelBuying._currentFullListType != Item.TYPES.BIDDING) {
                dockHeaderBox = $("#panel-buying-dock-header-box");
                floatHeaderBox = $("#panel-buying-float-header-box");
            }
        }
        else if (lastSelectedTabId == "tab-selling") {
            if ($("#panel-selling-main-full-list").is(':visible') &&
                (PanelSelling._currentFullListType != Item.TYPES.SCHEDULED) &&
                (PanelSelling._currentFullListType != Item.TYPES.SELLING_OFFER)) {
                dockHeaderBox = $("#panel-selling-dock-header-box");
                floatHeaderBox = $("#panel-selling-float-header-box");
            }
        }
        else if (lastSelectedTabId == "tab-watching") {
            dockHeaderBox = $("#panel-watching-dock-header-box");
            floatHeaderBox = $("#panel-watching-float-header-box");
        }
        if (dockHeaderBox && floatHeaderBox) {
            this._scrollFrom = -1;
            dockHeaderBox.css("opacity", 1);
            floatHeaderBox.hide();
        }
    },
    _updateDockHeader: function (aScroll) {
        var lastSelectedTabId = $(".tab-item.active").attr("id");
        var dockHeaderBox;
        var floatHeaderBox;
        if (lastSelectedTabId == "tab-buying") {
            if ($("#panel-buying-main-full-list").is(':visible') &&
                PanelBuying._currentFullListType != Item.TYPES.BIDDING) {
                dockHeaderBox = $("#panel-buying-dock-header-box");
                floatHeaderBox = $("#panel-buying-float-header-box");
            }
        }
        else if (lastSelectedTabId == "tab-selling") {
            if ($("#panel-selling-main-full-list").is(':visible') &&
                (PanelSelling._currentFullListType != Item.TYPES.SCHEDULED) &&
                (PanelSelling._currentFullListType != Item.TYPES.SELLING_OFFER)) {
                dockHeaderBox = $("#panel-selling-dock-header-box");
                floatHeaderBox = $("#panel-selling-float-header-box");
            }
        }
        else if (lastSelectedTabId == "tab-watching") {
            dockHeaderBox = $("#panel-watching-dock-header-box");
            floatHeaderBox = $("#panel-watching-float-header-box");
        }
        if (dockHeaderBox && floatHeaderBox && aScroll.mcs && aScroll.mcs.top) {
            var topOffset = aScroll.mcs.top;
            if (this._scrollFrom) {
                if (this._scrollFrom > topOffset) {
                    if (topOffset < -120) {
                        floatHeaderBox.css("opacity", 0.94);
                        floatHeaderBox.show();
                    }
                    else if (topOffset < -20) {
                        dockHeaderBox.css("opacity", 0);
                        floatHeaderBox.css("opacity", 0.00783 * topOffset * -1);
                        floatHeaderBox.show();
                    }
                    else {
                        dockHeaderBox.css("opacity", (1 - 0.05 * topOffset * -1));
                    }
                }
                else if (this._scrollFrom < topOffset) {
                    if (topOffset >= -50 && floatHeaderBox.is(':visible')) {
                        floatHeaderBox.slideUp("fast");
                    }
                    if (topOffset < -120) {
                        floatHeaderBox.css("opacity", 0.94);
                        floatHeaderBox.show();
                    }
                    else if (topOffset < -20) {
                        dockHeaderBox.css("opacity", (1 - 0.05 * topOffset * -1));
                        floatHeaderBox.css("opacity", 0.00783 * topOffset * -1);
                        floatHeaderBox.show();
                    }
                    else {
                        dockHeaderBox.css("opacity", 1);
                        floatHeaderBox.hide();
                    }
                }
                this._scrollFrom = null;
            }
            else {
                this._scrollFrom = topOffset;
            }
        }
    },
    showDockHeaderForWatching: function () {
        $("#panel-watching-dock-header-box").css("opacity", 1);
        $("#panel-watching-float-header-box").hide();
    },
    _loadInnerPages: function () {
        $("#panel-notification-content").load("core/panelNotification.html", function () {
            PanelNotification.init();
        });
        $("#panel-watching-content").load("core/panelWatching.html", function () {
            PanelWatching.init();
        });
        $("#panel-buying-content").load("core/panelBuying.html", function () {
            PanelBuying.init();
        });
        $("#panel-selling-content").load("core/panelSelling.html", function () {
            PanelSelling.init();
        });
    }
};
$(window).unload(function () { PanelContainer.uninit(); });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWxDb250YWluZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi91aS92aWV3L2NvcmUvcGFuZWxDb250YWluZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFFSCxJQUFJLGNBQWMsR0FBRztJQUVuQixJQUFJLEVBQUc7UUFDTCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFFaEIsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV2QixPQUFPLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtZQUM1QixDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzVDLENBQUMsRUFBRTtZQUNELENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxFQUFFO1lBQ0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9CLENBQUMsRUFBRTtZQUNELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pDLEtBQUssY0FBYztvQkFDakIsYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUN6QixLQUFLLENBQUM7Z0JBQ1IsS0FBSyxZQUFZO29CQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3JELFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO29CQUNuQyxDQUFDO29CQUNELEtBQUssQ0FBQztnQkFDUixLQUFLLGFBQWE7b0JBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQywrQkFBK0IsQ0FBQyxDQUFD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LENBQUMsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRTtZQUN2RCxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFDSCxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDekQsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGLENBQUM7QUFFRixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLGNBQWEsY0FBYyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIENvcHlyaWdodCAoQykgMjAwNy0yMDE1IGVCYXkgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICovXG5cbnZhciBQYW5lbENvbnRhaW5lciA9IHtcblxuICBpbml0IDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgJChcIltyZWxePWkxOG5dXCIpLmkxOG4oKTtcbiAgICB0aGlzLl9sb2FkSW5uZXJQYWdlcygpO1xuXG4gICAgU2lkZWJhci5zdHlsZVNjcm9sbChcInBhbmVsc1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICQoXCIjc3RhdHVzLXBhbmVsXCIpLmFkZENsYXNzKFwiaGFzLXNjcm9sbFwiKTtcbiAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICQoXCIjc3RhdHVzLXBhbmVsXCIpLnJlbW92ZUNsYXNzKFwiaGFzLXNjcm9sbFwiKTtcbiAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgIHRoYXQuX3VwZGF0ZURvY2tIZWFkZXIodGhpcyk7XG4gICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICBzd2l0Y2ggKCQoXCIudGFiLWl0ZW0uYWN0aXZlXCIpLmF0dHIoXCJpZFwiKSkge1xuICAgICAgICBjYXNlIFwidGFiLXdhdGNoaW5nXCI6XG4gICAgICAgICAgUGFuZWxXYXRjaGluZy5sb2FkTW9yZSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGFiLWJ1eWluZ1wiOlxuICAgICAgICAgIGlmICgkKFwiI3BhbmVsLWJ1eWluZy1tYWluLWZ1bGwtbGlzdFwiKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgUGFuZWxCdXlpbmcubG9hZE1vcmVUb0Z1bGxMaXN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGFiLXNlbGxpbmdcIjpcbiAgICAgICAgICBpZiAoJChcIiNwYW5lbC1zZWxsaW5nLW1haW4tZnVsbC1saXN0XCIpLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICBQYW5lbFNlbGxpbmcubG9hZE1vcmVUb0Z1bGxMaXN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgLy8gZW5zdXJlIHRvIGRpc3BsYXkgY29ycmVjdCBpdGVtcyB3aGVuIHNjcm9sbCB0byB0aGUgdG9wXG4gICAgICB0aGF0Ll9zY3JvbGxGcm9tID0gLTE7XG4gICAgICB0aGF0Ll91cGRhdGVEb2NrSGVhZGVyKHRoaXMpO1xuICAgIH0pO1xuICB9LFxuXG4gIHVuaW5pdCA6IGZ1bmN0aW9uKCkge1xuICB9LFxuXG4gIHJlc2V0RG9ja0hlYWRlciA6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsYXN0U2VsZWN0ZWRUYWJJZCA9ICQoXCIudGFiLWl0ZW0uYWN0aXZlXCIpLmF0dHIoXCJpZFwiKTtcbiAgICB2YXIgZG9ja0hlYWRlckJveDtcbiAgICB2YXIgZmxvYXRIZWFkZXJCb3g7XG5cbiAgICBpZiAobGFzdFNlbGVjdGVkVGFiSWQgPT0gXCJ0YWItYnV5aW5nXCIpIHtcbiAgICAgIGlmICgkKFwiI3BhbmVsLWJ1eWluZy1tYWluLWZ1bGwtbGlzdFwiKS5pcygnOnZpc2libGUnKSAmJlxuICAgICAgICAgIFBhbmVsQnV5aW5nLl9jdXJyZW50RnVsbExpc3RUeXBlICE9IEl0ZW0uVFlQRVMuQklERElORykge1xuICAgICAgICBkb2NrSGVhZGVyQm94ID0gJChcIiNwYW5lbC1idXlpbmctZG9jay1oZWFkZXItYm94XCIpO1xuICAgICAgICBmbG9hdEhlYWRlckJveCA9ICQoXCIjcGFuZWwtYnV5aW5nLWZsb2F0LWhlYWRlci1ib3hcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChsYXN0U2VsZWN0ZWRUYWJJZCA9PSBcInRhYi1zZWxsaW5nXCIpIHtcbiAgICAgIGlmICgkKFwiI3BhbmVsLXNlbGxpbmctbWFpbi1mdWxsLWxpc3RcIikuaXMoJzp2aXNpYmxlJykgJiZcbiAgICAgICAgICAoUGFuZWxTZWxsaW5nLl9jdXJyZW50RnVsbExpc3RUeXBlICE9IEl0ZW0uVFlQRVMuU0NIRURVTEVEKSAmJlxuICAgICAgICAgIChQYW5lbFNlbGxpbmcuX2N1cnJlbnRGdWxsTGlzdFR5cGUgIT0gSXRlbS5UWVBFUy5TRUxMSU5HX09GRkVSKSkge1xuICAgICAgICBkb2NrSGVhZGVyQm94ID0gJChcIiNwYW5lbC1zZWxsaW5nLWRvY2staGVhZGVyLWJveFwiKTtcbiAgICAgICAgZmxvYXRIZWFkZXJCb3ggPSAkKFwiI3BhbmVsLXNlbGxpbmctZmxvYXQtaGVhZGVyLWJveFwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGxhc3RTZWxlY3RlZFRhYklkID09IFwidGFiLXdhdGNoaW5nXCIpIHtcbiAgICAgIGRvY2tIZWFkZXJCb3ggPSAkKFwiI3BhbmVsLXdhdGNoaW5nLWRvY2staGVhZGVyLWJveFwiKTtcbiAgICAgIGZsb2F0SGVhZGVyQm94ID0gJChcIiNwYW5lbC13YXRjaGluZy1mbG9hdC1oZWFkZXItYm94XCIpO1xuICAgIH1cblxuICAgIGlmIChkb2NrSGVhZGVyQm94ICYmIGZsb2F0SGVhZGVyQm94KSB7XG4gICAgICB0aGlzLl9zY3JvbGxGcm9tID0gLTE7XG4gICAgICBkb2NrSGVhZGVyQm94LmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4gICAgICBmbG9hdEhlYWRlckJveC5oaWRlKCk7XG4gICAgfVxuICB9LFxuXG4gIF91cGRhdGVEb2NrSGVhZGVyIDogZnVuY3Rpb24oYVNjcm9sbCkge1xuICAgIHZhciBsYXN0U2VsZWN0ZWRUYWJJZCA9ICQoXCIudGFiLWl0ZW0uYWN0aXZlXCIpLmF0dHIoXCJpZFwiKTtcbiAgICB2YXIgZG9ja0hlYWRlckJveDtcbiAgICB2YXIgZmxvYXRIZWFkZXJCb3g7XG5cbiAgICBpZiAobGFzdFNlbGVjdGVkVGFiSWQgPT0gXCJ0YWItYnV5aW5nXCIpIHtcbiAgICAgIGlmICgkKFwiI3BhbmVsLWJ1eWluZy1tYWluLWZ1bGwtbGlzdFwiKS5pcygnOnZpc2libGUnKSAmJlxuICAgICAgICAgIFBhbmVsQnV5aW5nLl9jdXJyZW50RnVsbExpc3RUeXBlICE9IEl0ZW0uVFlQRVMuQklERElORykge1xuICAgICAgICBkb2NrSGVhZGVyQm94ID0gJChcIiNwYW5lbC1idXlpbmctZG9jay1oZWFkZXItYm94XCIpO1xuICAgICAgICBmbG9hdEhlYWRlckJveCA9ICQoXCIjcGFuZWwtYnV5aW5nLWZsb2F0LWhlYWRlci1ib3hcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChsYXN0U2VsZWN0ZWRUYWJJZCA9PSBcInRhYi1zZWxsaW5nXCIpIHtcbiAgICAgIGlmICgkKFwiI3BhbmVsLXNlbGxpbmctbWFpbi1mdWxsLWxpc3RcIikuaXMoJzp2aXNpYmxlJykgJiZcbiAgICAgICAgICAoUGFuZWxTZWxsaW5nLl9jdXJyZW50RnVsbExpc3RUeXBlICE9IEl0ZW0uVFlQRVMuU0NIRURVTEVEKSAmJlxuICAgICAgICAgIChQYW5lbFNlbGxpbmcuX2N1cnJlbnRGdWxsTGlzdFR5cGUgIT0gSXRlbS5UWVBFUy5TRUxMSU5HX09GRkVSKSkge1xuICAgICAgICBkb2NrSGVhZGVyQm94ID0gJChcIiNwYW5lbC1zZWxsaW5nLWRvY2staGVhZGVyLWJveFwiKTtcbiAgICAgICAgZmxvYXRIZWFkZXJCb3ggPSAkKFwiI3BhbmVsLXNlbGxpbmctZmxvYXQtaGVhZGVyLWJveFwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGxhc3RTZWxlY3RlZFRhYklkID09IFwidGFiLXdhdGNoaW5nXCIpIHtcbiAgICAgIGRvY2tIZWFkZXJCb3ggPSAkKFwiI3BhbmVsLXdhdGNoaW5nLWRvY2staGVhZGVyLWJveFwiKTtcbiAgICAgIGZsb2F0SGVhZGVyQm94ID0gJChcIiNwYW5lbC13YXRjaGluZy1mbG9hdC1oZWFkZXItYm94XCIpO1xuICAgIH1cblxuICAgIGlmIChkb2NrSGVhZGVyQm94ICYmIGZsb2F0SGVhZGVyQm94ICYmIGFTY3JvbGwubWNzICYmIGFTY3JvbGwubWNzLnRvcCkge1xuICAgICAgdmFyIHRvcE9mZnNldCA9IGFTY3JvbGwubWNzLnRvcDtcblxuICAgICAgaWYgKHRoaXMuX3Njcm9sbEZyb20pIHtcbiAgICAgICAgaWYgKHRoaXMuX3Njcm9sbEZyb20gPiB0b3BPZmZzZXQpIHtcbiAgICAgICAgICAvLyBkZXRlY3Qgc2Nyb2xsIGRvd25cbiAgICAgICAgICBpZiAodG9wT2Zmc2V0IDwgLTEyMCkge1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guY3NzKFwib3BhY2l0eVwiLCAwLjk0KTtcbiAgICAgICAgICAgIGZsb2F0SGVhZGVyQm94LnNob3coKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRvcE9mZnNldCA8IC0yMCkge1xuICAgICAgICAgICAgZG9ja0hlYWRlckJveC5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guY3NzKFwib3BhY2l0eVwiLCAwLjAwNzgzICogdG9wT2Zmc2V0ICogLTEpO1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guc2hvdygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2NrSGVhZGVyQm94LmNzcyhcIm9wYWNpdHlcIiwgKDEgLSAwLjA1ICogdG9wT2Zmc2V0ICogLTEpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fc2Nyb2xsRnJvbSA8IHRvcE9mZnNldCkge1xuICAgICAgICAgIC8vIGRldGVjdCBzY3JvbGwgdXBcbiAgICAgICAgICBpZiAodG9wT2Zmc2V0ID49IC01MCAmJiBmbG9hdEhlYWRlckJveC5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guc2xpZGVVcChcImZhc3RcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0b3BPZmZzZXQgPCAtMTIwKSB7XG4gICAgICAgICAgICBmbG9hdEhlYWRlckJveC5jc3MoXCJvcGFjaXR5XCIsIDAuOTQpO1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guc2hvdygpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodG9wT2Zmc2V0IDwgLTIwKSB7XG4gICAgICAgICAgICBkb2NrSGVhZGVyQm94LmNzcyhcIm9wYWNpdHlcIiwgKDEgLSAwLjA1ICogdG9wT2Zmc2V0ICogLTEpKTtcbiAgICAgICAgICAgIGZsb2F0SGVhZGVyQm94LmNzcyhcIm9wYWNpdHlcIiwgMC4wMDc4MyAqIHRvcE9mZnNldCAqIC0xKTtcbiAgICAgICAgICAgIGZsb2F0SGVhZGVyQm94LnNob3coKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9ja0hlYWRlckJveC5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAgICAgZmxvYXRIZWFkZXJCb3guaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zY3JvbGxGcm9tID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3Njcm9sbEZyb20gPSB0b3BPZmZzZXQ7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHNob3dEb2NrSGVhZGVyRm9yV2F0Y2hpbmcgOiBmdW5jdGlvbigpIHtcbiAgICAkKFwiI3BhbmVsLXdhdGNoaW5nLWRvY2staGVhZGVyLWJveFwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctZmxvYXQtaGVhZGVyLWJveFwiKS5oaWRlKCk7XG4gIH0sXG5cbiAgX2xvYWRJbm5lclBhZ2VzIDogZnVuY3Rpb24oKSB7XG4gICAgJChcIiNwYW5lbC1ub3RpZmljYXRpb24tY29udGVudFwiKS5sb2FkKFwiY29yZS9wYW5lbE5vdGlmaWNhdGlvbi5odG1sXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgUGFuZWxOb3RpZmljYXRpb24uaW5pdCgpO1xuICAgIH0pO1xuICAgICQoXCIjcGFuZWwtd2F0Y2hpbmctY29udGVudFwiKS5sb2FkKFwiY29yZS9wYW5lbFdhdGNoaW5nLmh0bWxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBQYW5lbFdhdGNoaW5nLmluaXQoKTtcbiAgICB9KTtcbiAgICAkKFwiI3BhbmVsLWJ1eWluZy1jb250ZW50XCIpLmxvYWQoXCJjb3JlL3BhbmVsQnV5aW5nLmh0bWxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBQYW5lbEJ1eWluZy5pbml0KCk7XG4gICAgfSk7XG4gICAgJChcIiNwYW5lbC1zZWxsaW5nLWNvbnRlbnRcIikubG9hZChcImNvcmUvcGFuZWxTZWxsaW5nLmh0bWxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBQYW5lbFNlbGxpbmcuaW5pdCgpO1xuICAgIH0pO1xuICB9XG59O1xuXG4kKHdpbmRvdykudW5sb2FkKGZ1bmN0aW9uKCkgeyBQYW5lbENvbnRhaW5lci51bmluaXQoKTsgfSk7XG4iXX0=